---
title: "Summary of BDPG results for single Reserve Selector"
author: "Bill Langford"
date: "`r Sys.Date()`"
output:
  pdf_document:
    fig_caption: yes
    number_sections: yes
    toc: yes
    toc_depth: 4
  html_notebook:
    toc: yes
    toc_depth: 4
  html_document:
    df_print: paged
    toc: yes
    toc_depth: '4'
---

#  General

This is just a quick and dirty summary of what I think are the main results that I want to put in the first paper.  I need this to pare down what I'm doing in the other documents.

This file is cloned from mainResults.Rmd and mainResults_singleRS_RandomSampleExps.Rmd, which were getting too big and unwieldy.  In here, I will strip out all references to anything other than a single reserve selector and the most important results.  The whole thing should be trivial to rerun for each different reserve selector by just changing the variable `rs_name`.

This file is meant to reduce all of the previous Rmd files that have tons of different forms of results in them down to just the results that are candidates for the paper.  Those previous Rmd files include mainResults.Rmd, mainResults_singleRS.Rmd, mainResults_singleRS_RandomSampleExps.Rmd, preliminaryAnalysis.Rmd, and secondCutNotebook.Rmd (and fourthCutNotebook.Rmd?).

-----------------------------

## TO DO

- Need to try filtering out any examples where the APP problem had any species from teh COR problem that had no occurrences in the APP problem
    - Those might be the source of the problems that had the huge error blowouts since they would have to reserve every PU in their search for the missing species
- Need to add other predictions
    - Predict using the Xu variables as inputs
    - Predict different outputs
    - Predict error magnification
    - Predict rep shortfall
    - Predict cost error
- Predict categorical outputs (w/ probabilities) instead of continuous ones
    - Predict the most heinous errors or magnifications
        - Seems like more than anything else, you'd like to know the order of magnitude of output errors so that you know if you've really blown it.
- Use other prediction methods
    - Caruana multi-ouput training, e.g., out err, mag, heinous
    - Use noisy categorical labels of input quality as inputs
        - For example, you could say something about likely FN and FP rate, e.g., on a 3 or 5 point scale.  However, I'm not sure how useful that is, given that the actual values for FN and FP were not much predictive use in the Cheating section below.  Still, if you knew that most errors were likely to be FN or FP, then would you know whether you were more likely to get rep shortfalls or cost overruns?
- May need to change inputs
    - Should add COR WRAP examples to the data as well
        - There's something a little strange about all this since it seems like the models would predict the same amount of error for a correct problem as for its related erroneous problem, wouldn't it?
        - Seems like this might be true for FN input error because the FN graphs have far fewer changes to them than FP graphs and so the graphs would seem like they'd be similar to the COR graph.
    - Probably want to change input sample to be more representative
        - There are many more samples from easier problems with smaller output errors in the training and testing data.  I think that's one reason for doing so poorly at predicting the cases with large output error.  May want to subsample more evenly in training and testing or add some kind of cost/weighting to better identify these since they're more important to get right.  Or are they?
    - Definitely need to set up better handling of cv, etc
- Need to replace current plot() code for models with ggplot() code
- Feature preprocessing
    - Haven't done any standardization or anything yet.
    
-----------------------------

##  knitr setup

Can't remember why this is here, but I'll leave it alone for now in case it was important.  Might just have been the default knitr file, however, the commenting out of "message=FALSE" suggests there was a reason for that, which might be related to what's happening in the comments in the "Load necessary files" section below.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)    #, message=FALSE)
```

-----------------------------

#  Set options

## Choose which reserve selector to analyze

```{r setRSname}
#rs_name = "Gurobi"
rs_name = "Marxan_SA"
#rs_name = "Marxan_SA_SS"
#rs_name = "ZL_Backward"
#rs_name = "ZL_Forward"
#rs_name = "SR_Backward"
#rs_name = "SR_Forward"
#rs_name = "UR_Backward"
#rs_name = "UR_Forward"
```

##  Choose test and train set controls.

```{r}
seed = set.seed (12345)

training_split_denom = 2    #  equal size test and train datasets
sample_training_data_with_replacement = FALSE    #  TRUE if bootstrapping
```

-----------------------------

#  Load necessary libraries

```{r message=FALSE}
    #  Note that "message=FALSE" is necessary for this chunk if you want to 
    #  generate pdfs.  When the tidyverse package is loaded, it writes puts 
    #  out a message that includes some unicode that the normal latex engine 
    #  (used to produce the pdf) can't handle and it crashes with the following 
    #  message:
    #       ! Package inputenc Error: Unicode character [sqrt symbol goes here] (U+221A)
    #       (inputenc)                not set up for use with LaTeX.
    #  Note that I've also had to remove the sqrt symbol from the error message 
    #  when embedding it in the comment here, because even inside the comment, 
    #  latex tried to render that and crashed.
    #  More information about this can be found at:
    #   - https://community.rstudio.com/t/tidyverse-1-2-1-knitting-to-pdf-issue/2880/4
    #   - https://community.rstudio.com/t/cant-render-tidyverse-1-2-startup-message-in-latex/2811/5
    #   - https://chrisbeeley.net/?p=1037

library (tidyverse)

library (corrplot)  #  For correlation plots
library (ranger)  #  For random forests

library (DMwR)    #  For regr.eval()
#library (DMwR2)  #  DON'T LOAD THIS - SOME EXAMPLES FROM BOOK FAIL SINCE THEIR 
                  #  TYPES HAVE CHANGED.  FOR EXAMPLE, algae IS A TIBBLE IN THE 
                  #  REVISED LIBRARY AND A DATA FRAME IN THE ORIGINAL.
                  #  THIS CAUSED SOME OF MY CODE TO CHOKE.
```

-----   

#  Load data

##  Define functions to read and write input and output data

```{r loadInputData}
#===============================================================================

load_input_data <- function (rs_name, base_path, suffix)
    {
    infile = paste0 (base_path, rs_name, suffix)

        #  I can't remember why I called these "msa".  It might stand for 
        #  multi-set analysis...
    
    df = read.csv (infile, header=TRUE, stringsAsFactors = FALSE)
    
    return (df)
    }

#===============================================================================

write_output_data <- function (df, rs_name, base_path, suffix)
    {
    outfile = paste0 (base_path, rs_name, suffix)
    cat ("\n\nIn write_output_data(), outfile = '", outfile, 
         "'\n", sep='')
    write.csv (df, outfile, row.names=FALSE)
    }

```

##  Set file paths

NOTE:  Leaving some of the old file paths in here for the moment, in case I need to go back to those results and want to know where they're stored.

```{r setFilePaths}
#===============================================================================

# # # base_path = "/Users/bill/D/Projects/ProblemDifficulty/Results/bdpg_20_variants_all_rs_easy_base/bdpg_20_variants_all_rs_easy_base_Combined_err_amts/"
# 
#     #  Easy
# base_path = "/Users/bill/D/Projects/ProblemDifficulty/Results/bdpg_20_variants_all_rs_easy_base_2nd_attempt/bdpg_20_variants_all_rs_easy_base_2nd_try_Combined_err_amts/"
# 
#     #  Hard
# base_path = "/Users/bill/D/Projects/ProblemDifficulty/Results/bdpg_20_variants_all_rs_HARD_base_first_attempt/bdpg_20_variants_all_rs_HARD_base_1st_try_Combined_err_amts/"

#     #  Hard - 2, 5, 7.5, 10 % error
# base_path = "/Users/bill/D/Projects/ProblemDifficulty/Results/bdpg_20_variants_all_rs_HARD_base_first_attempt/bdpg_20_variants_all_rs_HARD_base_02_05_075_10_Combined_err_amts/"

    #  Combined Easy and Hard (all Easy error levels, all Hard except 15%)
#base_path = "/Users/bill/D/Projects/ProblemDifficulty/Results/FullEasyHardV1/cln_easyHard."

#suffix = ".combined_results.csv"

#----------

base_path = "/Users/bill/D/Projects/ProblemDifficulty/Results/ExpGen6basicVariants/Combined_batches_1_2/Clean/cln_exp."

suffix = ".csv"
```

##  Load combined input data from multiple batches

```{r loadCombinedInputData}

easyHard_df    = load_input_data (rs_name, base_path, suffix)
```

##  Reduce full data set down to working data subset

Reduce the data set to just APP WRAP problems and examples with no input cost error.

2018 11 25 - NOTE that previous versions of this section didn't include many of the metrics from the bipartite library (since I had forgotten to include their calculation when doing the easy/hard experiments).  They also didn't include the various timing results, which I think may not be useful in looking for predicting problem difficulty and output error.

...  Code hidden for now  ...

```{r reduceFullDataToWorkingSet, include=FALSE}
#===============================================================================

reduce_full_data_to_working_set <- function (full_df)
    {
    working_df = select (full_df, #c(
                      
            #  Problem and reserve selector labels                     
                    id,     #  Easy or Hard
            
                    rs_method_name, 
                    rsp_combined_err_label, 
                    rsp_cor_or_app_str, 
                    rsp_base_wrap_str, 
                    
                    # rsr_tzar_run_ID, 
                    # rsr_UUID, 
                    # 
                    # rsp_file_name_prefix, 
                    # 
                    # rsp_UUID, 
                    # rsp_UUID_of_base_problem_that_has_err_added, 
                    # rsp_UUID_of_base_problem_that_is_wrapped, 
    
    
            #  Input descriptors
                    rsp_num_PUs, 
                    rsp_num_spp, 
                    rsp_num_spp_per_PU, 
                    rsp_correct_solution_cost, 
            
                    sppPUsum,
                    sppPUprod, 
            
            #  Post-gen knowable problem descriptors
            
                #  Species and PU counts
                    rsp_app_num_spp, 
                    rsp_app_num_PUs, 
                    
                #  igraph package metrics
    #                ig_rsp_UUID, 
            
                    ig_top, 
                    ig_bottom, 
                    ig_num_edges_m, 
                    ig_ktop, 
                    ig_kbottom, 
                    ig_bidens, 
                    ig_lcctop, 
                    ig_lccbottom, 
                    ig_distop, 
                    ig_disbottom, 
                    ig_cctop, 
                    ig_ccbottom, 
                    ig_cclowdottop, 
                    ig_cclowdotbottom, 
                    ig_cctopdottop, 
                    ig_cctopdotbottom, 
                    ig_mean_bottom_bg_redundancy, 
                    ig_median_bottom_bg_redundancy, 
                    ig_mean_top_bg_redundancy, 
                    ig_median_top_bg_redundancy, 
                    
                    ig_user_time, 
                    ig_system_time, 
                    ig_elapsed_time, 
                    ig_user_child_time, 
                    ig_sys_child_time, 
                                    
                #  bipartite package metrics
    #                bip_rsp_UUID, 

                    connectance, 
        
                    web_asymmetry,
                    links_per_PUsAndSpp,
                    cluster_coefficient,
                    weighted_NODF,
                    interaction_strength_asymmetry,
                    specialisation_asymmetry,
                    linkage_density,
                    weighted_connectance,
                    Shannon_diversity,
                    interaction_evenness,
                    Alatalo_interaction_evenness,
    
                    number.of.PUs,
                    number.of.Spp,
    
                    mean.number.of.shared.partners.PUs,
                    mean.number.of.shared.partners.Spp,
                    cluster.coefficient.PUs,
                    cluster.coefficient.Spp,
                    niche.overlap.PUs,
                    niche.overlap.Spp,
                    togetherness.PUs,
                    togetherness.Spp,
                    C.score.PUs,
                    C.score.Spp,
                    V.ratio.PUs,
                    V.ratio.Spp,
                    functional.complementarity.PUs,
                    functional.complementarity.Spp,
                    partner.diversity.PUs,
                    partner.diversity.Spp,
                    generality.PUs,
                    vulnerability.Spp,
                    
                    bip_user_time, 
                    bip_system_time, 
                    bip_elapsed_time, 
                    bip_user_child_time, 
                    bip_sys_child_time, 
    
    
                #  Possibly knowable realized input error values
                    rsp_realized_median_abs_cost_err_frac, 
                    rsp_realized_mean_abs_cost_err_frac, 
                    rsp_realized_sd_abs_cost_err_frac, 
                    rsp_FP_const_rate, 
                    rsp_FN_const_rate, 
                    
                    rsp_realized_FP_rate, 
                    rsp_realized_FN_rate, 
                    rsp_realized_Ftot_rate, 
                    rsp_euc_realized_FP_and_cost_in_err_frac, 
                    rsp_euc_realized_FN_and_cost_in_err_frac, 
                    rsp_euc_realized_Ftot_and_cost_in_err_frac, 
                    
                    rsp_wrap_is_imperfect,
                            
    
                #  Results and their errors
                    rs_solution_cost, 
                    rs_solution_cost_err_frac, 
                    abs_rs_solution_cost_err_frac, 
                    
                    rs_over_opt_cost_err_frac_of_possible_overcost, 
                    rs_under_opt_cost_err_frac_of_possible_undercost, 
                    
                    rsr_COR_euc_out_err_frac, 
                    
                            # rsr_APP_spp_rep_shortfall, 
                            # rsr_APP_solution_NUM_spp_covered, 
                            # rsr_APP_solution_FRAC_spp_covered, 

                    rsr_COR_spp_rep_shortfall, 
                    rsr_COR_solution_NUM_spp_covered, 
                    rsr_COR_solution_FRAC_spp_covered, 

        
                    err_mag, 
                    
                #  Reserve selector run times
                    RS_user_time, 
                    RS_system_time, 
                    RS_elapsed_time, 
                    RS_user_child_time, 
                    RS_sys_child_time
                      )
#    )
    
    #--------------------
    
        #  Now, remove all COR and BASE problems to leave just the APP WRAPs.
    
    working_df %>%
        filter (rsp_cor_or_app_str == "APP" & 
                rsp_base_wrap_str == "Wrap" & 
                (rsp_combined_err_label == "02-FP_only_NO_cost_err" | 
                 rsp_combined_err_label == "03-FN_only_NO_cost_err" | 
                 rsp_combined_err_label == "04-FP_and_FN_matched_NO_cost_err" | 
                 rsp_combined_err_label == "05-FP_and_FN_not_matched_NO_cost_err")) -> working_df 
    
    return (working_df)
    }

#------------------------------

working_df    = reduce_full_data_to_working_set (easyHard_df)
```

####  Check whether there are problems where COR and APP spp cts are not identical

```{r}
unequals = which (working_df$rsp_num_spp != working_df$rsp_app_num_spp)
cat ("\nNumber of correct and apparent spp pairs that are not the same = ", 
     length(unequals), "\n")

#plot (working_df$rsp_num_spp, working_df$rsp_app_num_spp)
```

### Plot num PUs vs. num spp to show range of problem sizes

...  Code hidden for now  ...

```{r, include=FALSE}
#===============================================================================

gg_numSpp_vs_numPUs_all_on_1 <- function (rs_name,
                                               sorted_msa_tib,
                                               ref_y = 0
                                               
                                               , shape_type="."
                                               , alpha_level=1
                                               )
    {
ggplot (data = sorted_msa_tib) +
        aes(x = rsp_num_spp,
                                    y = rsp_num_PUs,
        #                            color = rsp_combined_err_label)) +
#####                                    color = rsp_base_wrap_str) +
                                     color = id) +
# ##        geom_point() +
# #        geom_point(shape=".", alpha=1/10) +
         geom_point(shape=shape_type, alpha=alpha_level) +
# #        geom_point(shape=".") +
# #        geom_point(alpha=1/25) +


#             #                            color = rsp_combined_err_label)) +
# #                                         color = id
# #         ,
# #         shape="."
# #         ) +
# # ##            geom_point() +
# # #        geom_point(shape=".") +
# 
#                                     color = id) +
#         geom_point(shape=".", alpha=1) +

    



#####        scale_color_manual(breaks = c("Base", "Wrap"), values=c("red", "blue")) +
        scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +
#        stat_smooth(method = "lm", col = "green") +

    # ggplot (data = sorted_msa_tib) +
    #       geom_point (mapping = ) +
    #     #scale_color_viridis(discrete=TRUE) +
    #     scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +
    #
        ggtitle (paste0 (rs_name, " - Num Spp vs. Num PUs")) +
        theme(plot.title = element_text(hjust = 0.5)) +    #  To center the title

          geom_hline (yintercept = ref_y, linetype="dashed",
                        color = "black", size=0.5) +
          geom_abline (intercept=0, slope=1  #, linetype, color, size
                       ) +
          geom_abline (intercept=0, slope=5  #, linetype, color, size
                       ) +
          geom_abline (intercept=0, slope=10  #, linetype, color, size
                       )
    }

#===============================================================================

```

```{r plotNumSppVsNumPUs}
gg_numSpp_vs_numPUs_all_on_1 (rs_name,
                              
                                               #####easyHard_df,
                              working_df,
                              
                                               ref_y = 0
                                               
                                               # , shape_type="."
                                               # , alpha_level=1
                                               )

```

-----   

#  Plot results

## Input error vs. output error

- Generated hard problems were much harder than generated easy problems, as predicted
    - This statement came from when this file was analyzing the easy/hard data sets.  Not sure whether it is so easily expressed in this particular document.  Will have to look into how to show that here.
- There is lots of variation in problem difficulty at every level of input error
- Solution quality under uncertainty is not good, regardless of optimizer
- Not much difference in reserve selectors  
    - Smoothers were slightly better in median (ZL and SA_SS)
- Possible difference for Simple Richness on difficult problem?
- Also need to add plots for all output error fractions values below 1.

### Define plotting functions for input error vs. output error 

...  Code hidden for now  ...

```{r, include=FALSE}
#===============================================================================

gg_eucInTot_vs_eucOutTot_all_on_1 <- function (rs_name,
                                               sorted_msa_tib,
                                               ref_y = 0
                                               
                                               , shape_type="."
                                               , alpha_level=1
                                               )
    {
ggplot (data = sorted_msa_tib) +
        aes(x = rsp_euc_realized_Ftot_and_cost_in_err_frac,
                                    y = rsr_COR_euc_out_err_frac,
        #                            color = rsp_combined_err_label)) +
#####                                    color = rsp_base_wrap_str) +
                                     color = id) +
# ##        geom_point() +
# #        geom_point(shape=".", alpha=1/10) +
         geom_point(shape=shape_type, alpha=alpha_level) +
# #        geom_point(shape=".") +
# #        geom_point(alpha=1/25) +


#             #                            color = rsp_combined_err_label)) +
# #                                         color = id
# #         ,
# #         shape="."
# #         ) +
# # ##            geom_point() +
# # #        geom_point(shape=".") +
# 
#                                     color = id) +
#         geom_point(shape=".", alpha=1) +

    



#####        scale_color_manual(breaks = c("Base", "Wrap"), values=c("red", "blue")) +
        scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +
        stat_smooth(method = "lm", col = "green") +

    # ggplot (data = sorted_msa_tib) +
    #       geom_point (mapping = ) +
    #     #scale_color_viridis(discrete=TRUE) +
    #     scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +
    #
        ggtitle (paste0 (rs_name, " - Tot in err vs. Tot out err")) +
        theme(plot.title = element_text(hjust = 0.5)) +    #  To center the title

          geom_hline (yintercept = ref_y, linetype="dashed",
                        color = "black", size=0.5) +
          geom_abline (intercept=0, slope=1  #, linetype, color, size
                       ) +
          geom_abline (intercept=0, slope=5  #, linetype, color, size
                       ) +
          geom_abline (intercept=0, slope=10  #, linetype, color, size
                       )
    }

#===============================================================================

gg_eucInTot_vs_eucOutTot_facetted_by_err_label <- function (rs_name,
                                                            sorted_msa_tib,
                                                            ref_y = 0
                                                            , shape_type = "."
                                                            , alpha_level = 1
                                                            )
    {
    ggplot (data = sorted_msa_tib) +
      geom_point (mapping = aes(x = rsp_euc_realized_Ftot_and_cost_in_err_frac,
                                y = rsr_COR_euc_out_err_frac,
    #                            color = rsp_combined_err_label)) +
    #                             color = id
    # ), 
    # shape="."
    # ) +
 # color = id
 #    ), 
 #    shape="."
 #    ) +
 color = id
    ), 
    shape="."
    ) +
        

    #scale_color_viridis(discrete=TRUE) +
    #scale_color_brewer(palette="Set1") +
    scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +

    ggtitle (paste0 (rs_name, " - Tot in err vs. Tot out err by Err Class")) +
    theme(plot.title = element_text(hjust = 0.5)) +    #  To center the title

      facet_wrap (~ rsp_combined_err_label, nrow = 5) +
      geom_hline (yintercept = ref_y, linetype="dashed",
                    color = "black", size=0.5) +
      geom_abline (intercept=0, slope=1  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=5  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=10  #, linetype, color, size
                   )
    }

#===============================================================================

gg_eucInTot_vs_eucOutTot_facetted_by_id <- function (rs_name,
                                                            sorted_msa_tib,
                                                            ref_y = 0
                                                            , shape_type = "."
                                                            , alpha_level = 1
                                                            )
    {
    ggplot (data = sorted_msa_tib) +
      geom_point (mapping = aes(x = rsp_euc_realized_Ftot_and_cost_in_err_frac,
                                y = rsr_COR_euc_out_err_frac,
    #                            color = rsp_combined_err_label)) +
    #                             color = id
    # ), 
    # shape="."
    # ) +
 # color = id
 #    ), 
 #    shape="."
 #    ) +
 color = id
    ), 
    shape="."
    ) +
        

    #scale_color_viridis(discrete=TRUE) +
    #scale_color_brewer(palette="Set1") +
    scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +

    ggtitle (paste0 (rs_name, " - Tot in err vs. Tot out err by Batch ID")) +
    theme(plot.title = element_text(hjust = 0.5)) +    #  To center the title

      facet_wrap (~ id, nrow = 2) +
      geom_hline (yintercept = ref_y, linetype="dashed",
                    color = "black", size=0.5) +
      geom_abline (intercept=0, slope=1  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=5  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=10  #, linetype, color, size
                   )
    }
```

### Plot the input error vs output error 

#### Full data set

```{r}

gg_eucInTot_vs_eucOutTot_all_on_1 (rs_name, easyHard_df, ref_y = 0
#                                   , shape_type = 1, alpha_level = 1
                                   )
```

#### Full data set, just values that are not huge errors

Will comment this out for the moment, since I'm not sure I want to plot these anymore.  They seem to not apply for gurobi and Marxan_SA, since they don't have such huge errors as some of the other reserve selectors.  May just need to have some of these outputs be dependent on which reserve selector you're looking at.

```
easyHard_df %>% 
    filter (rsr_COR_euc_out_err_frac <= 1) -> easyHard_not_huge_out_err_df
gg_eucInTot_vs_eucOutTot_all_on_1 (rs_name, easyHard_not_huge_out_err_df, ref_y = 0
, shape_type = ".", alpha_level = 1
)

```

#### Working data set

Plot the same results for working data set that only includes APP WRAP problems that have no input cost error.  Note that this changes the scaling and the fit lines.

```{r}
gg_eucInTot_vs_eucOutTot_all_on_1 (rs_name, working_df, ref_y = 0
#, shape_type = 1, alpha_level = 1/20
                                   )
```

#### Working data set, just values that are not huge errors

Will comment this out for the moment, since I'm not sure I want to plot these anymore.  They seem to not apply for gurobi and Marxan_SA, since they don't have such huge errors as some of the other reserve selectors.  May just need to have some of these outputs be dependent on which reserve selector you're looking at.

```
working_df %>% 
    filter (rsr_COR_euc_out_err_frac <= 1) -> working_not_huge_out_err_df
gg_eucInTot_vs_eucOutTot_all_on_1 (rs_name, working_not_huge_out_err_df, ref_y = 0
#, shape_type = ".", alpha_level = 1/20
                                   )
```

##  Error magnification

### Optimization often amplifies input error

Not sure this needs a separate plot, since the 10:1, 5:1, and 1:1 lines show it so well and the actual exact numbers aren't that important.

####  Show all magnification values first (to show full range)

```{r}
plot (working_df$rsp_euc_realized_Ftot_and_cost_in_err_frac, 
      working_df$err_mag, 
      main=paste0 ("Input error vs. Error Magnification\n", rs_name), 
      xlab="Total Euc Input Error Frac",
      ylab="Err magnification")
```

####  Show all magnification values below 10

This gets rid of all the extreme values that result at tiny, tiny input errors.

```{r}
idxs_of_not_huge_err_mags = which (working_df$err_mag <= 10)
plot (working_df$rsp_euc_realized_Ftot_and_cost_in_err_frac [idxs_of_not_huge_err_mags], 
      working_df$err_mag [idxs_of_not_huge_err_mags], 
      main=paste0 ("Input error vs. Error Magnification (<= 10)\n", rs_name), 
      xlab="Total Euc Input Error Frac",
      ylab="Err magnification")
```

##  Different types of input error produced different amounts of output error

- Uniform random cost error had almost no impact anywhere  
- FN produced ...  
- FP produced ...  
- Mixed was determined by FN or FP dominance  

NOTE:  This plot needs to be redone and broken apart.  The facetting done here makes it hard to see what's going on for the FN plots because everything there is compressed into one tiny vertical band.  That's because the x-axis is showing total input error rather than just FN error and total input error is small when FN is the dominant form of error.  If you just select out the FN-dominant errors, then plot, it will rescale to a much more appropriate x-axis.  

```{r}
gg_eucInTot_vs_eucOutTot_facetted_by_id (rs_name, working_df, ref_y = 0)
```


```{r}
#####gg_eucInTot_vs_eucOutTot_facetted_by_err_label (rs_name, easyHard_df, ref_y = 0)
gg_eucInTot_vs_eucOutTot_facetted_by_err_label (rs_name, working_df, ref_y = 0)

# easyHard_df %>% 
#     filter (rsr_COR_euc_out_err_frac <= 1) -> not_huge_out_err_df
#####gg_eucInTot_vs_eucOutTot_facetted_by_err_label (rs_name, easyHard_not_huge_out_err_df, ref_y = 0)
# working_df %>% 
#     filter (rsr_COR_euc_out_err_frac <= 1) -> not_huge_out_err_df
#####gg_eucInTot_vs_eucOutTot_facetted_by_err_label (rs_name, working_not_huge_out_err_df, ref_y = 0)

```

##  FN-dominated input errors


```{r}
#===============================================================================

gg_eucInTot_vs_eucOutTot_facetted_by_FN_dominance <- function (rs_name,
                                                            sorted_msa_tib,
                                                            ref_y = 0
                                                            , shape_type = "."
                                                            , alpha_level = 1
                                                            )
    {
    ggplot (data = sorted_msa_tib) +
      geom_point (mapping = aes(x = rsp_euc_realized_Ftot_and_cost_in_err_frac,
                                y = rsr_COR_euc_out_err_frac,
    #                            color = rsp_combined_err_label)) +
    #                             color = id
    # ), 
    # shape="."
    # ) +
 # color = id
 #    ), 
 #    shape="."
 #    ) +
 color = id
    ), 
    shape="."
    ) +
        

    #scale_color_viridis(discrete=TRUE) +
    #scale_color_brewer(palette="Set1") +
    scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +

    ggtitle (paste0 (rs_name, " - Tot in err vs. Tot out err by Err Class")) +
    theme(plot.title = element_text(hjust = 0.5)) +    #  To center the title

      facet_wrap (~ rsp_combined_err_label, nrow = 2) +
      geom_hline (yintercept = ref_y, linetype="dashed",
                    color = "black", size=0.5) +
      geom_abline (intercept=0, slope=1  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=5  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=10  #, linetype, color, size
                   )
    }

#===============================================================================

gg_rsp_realized_FN_rate_vs_eucOutTot_facetted_by_FN_dominance <- function (rs_name,
                                                            sorted_msa_tib,
                                                            ref_y = 0
                                                            , shape_type = "."
                                                            , alpha_level = 1
                                                            )
    {
    ggplot (data = sorted_msa_tib) +
      geom_point (mapping = aes(x = rsp_realized_FN_rate,
                                y = rsr_COR_euc_out_err_frac,
    #                            color = rsp_combined_err_label)) +
    #                             color = id
    # ), 
    # shape="."
    # ) +
 # color = id
 #    ), 
 #    shape="."
 #    ) +
 color = id
    ), 
    shape="."
    ) +
        

    #scale_color_viridis(discrete=TRUE) +
    #scale_color_brewer(palette="Set1") +
    scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +

    ggtitle (paste0 (rs_name, " - Realized FN rate vs. Tot out err by Err Class")) +
    theme(plot.title = element_text(hjust = 0.5)) +    #  To center the title

      facet_wrap (~ rsp_combined_err_label, nrow = 2) +
      geom_hline (yintercept = ref_y, linetype="dashed",
                    color = "black", size=0.5) +
      geom_abline (intercept=0, slope=1  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=5  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=10  #, linetype, color, size
                   )
    }
```

```{r}
working_df %>% 
    filter (rsp_combined_err_label == "03-FN_only_NO_cost_err" | 
            rsp_combined_err_label == "04-FP_and_FN_matched_NO_cost_err"
) -> FN_dominant_working_df
```

```{r}
gg_eucInTot_vs_eucOutTot_facetted_by_FN_dominance (rs_name,
                                                   FN_dominant_working_df, 
                                                   ref_y = 0)
```

```{r}
gg_rsp_realized_FN_rate_vs_eucOutTot_facetted_by_FN_dominance (rs_name,
                                                   FN_dominant_working_df, 
                                                   ref_y = 0)
```



###  Do things like num_spp predict total output error under FN-dominated error?

```{r}
#===============================================================================

gg_rsp_num_PUs_vs_eucOutTot_facetted_by_FN_dominance <- function (rs_name,
                                                            sorted_msa_tib,
                                                            ref_y = 0
                                                            , shape_type = "."
                                                            , alpha_level = 1
                                                            )
    {
    ggplot (data = sorted_msa_tib) +
      geom_point (mapping = aes(x = rsp_num_PUs,
                                y = rsr_COR_euc_out_err_frac,
    #                            color = rsp_combined_err_label)) +
    #                             color = id
    # ), 
    # shape="."
    # ) +
 # color = id
 #    ), 
 #    shape="."
 #    ) +
 color = id
    ), 
    shape="."
    ) +
        

    #scale_color_viridis(discrete=TRUE) +
    #scale_color_brewer(palette="Set1") +
    scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +

    ggtitle (paste0 (rs_name, " - COR num PUs vs. Tot out err by Err Class")) +
    theme(plot.title = element_text(hjust = 0.5)) +    #  To center the title

      facet_wrap (~ rsp_combined_err_label, nrow = 2) +
      geom_hline (yintercept = ref_y, linetype="dashed",
                    color = "black", size=0.5) +
      geom_abline (intercept=0, slope=1  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=5  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=10  #, linetype, color, size
                   )
    }

```

```{r}
gg_rsp_num_PUs_vs_eucOutTot_facetted_by_FN_dominance (rs_name,
                                                   FN_dominant_working_df, 
                                                   ref_y = 0)
```

```{r}
#===============================================================================

gg_rsp_num_spp_vs_eucOutTot_facetted_by_FN_dominance <- function (rs_name,
                                                            sorted_msa_tib,
                                                            ref_y = 0
                                                            , shape_type = "."
                                                            , alpha_level = 1
                                                            )
    {
    ggplot (data = sorted_msa_tib) +
      geom_point (mapping = aes(x = rsp_num_spp,
                                y = rsr_COR_euc_out_err_frac,
    #                            color = rsp_combined_err_label)) +
    #                             color = id
    # ), 
    # shape="."
    # ) +
 # color = id
 #    ), 
 #    shape="."
 #    ) +
 color = id
    ), 
    shape="."
    ) +
        

    #scale_color_viridis(discrete=TRUE) +
    #scale_color_brewer(palette="Set1") +
    scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +

    ggtitle (paste0 (rs_name, " - COR num spp vs. Tot out err by Err Class")) +
    theme(plot.title = element_text(hjust = 0.5)) +    #  To center the title

      facet_wrap (~ rsp_combined_err_label, nrow = 2) +
      geom_hline (yintercept = ref_y, linetype="dashed",
                    color = "black", size=0.5) +
      geom_abline (intercept=0, slope=1  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=5  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=10  #, linetype, color, size
                   )
    }

```

```{r}
gg_rsp_num_spp_vs_eucOutTot_facetted_by_FN_dominance (rs_name,
                                                   FN_dominant_working_df, 
                                                   ref_y = 0)
```

...  Code hidden for now  ...

```{r, include=FALSE}
#===============================================================================

gg_rsp_num_spp_per_PU_vs_eucOutTot_facetted_by_FN_dominance <- function (rs_name,
                                                            sorted_msa_tib,
                                                            ref_y = 0
                                                            , shape_type = "."
                                                            , alpha_level = 1
                                                            )
    {
    ggplot (data = sorted_msa_tib) +
      geom_point (mapping = aes(x = rsp_num_spp_per_PU,
                                y = rsr_COR_euc_out_err_frac,
    #                            color = rsp_combined_err_label)) +
    #                             color = id
    # ), 
    # shape="."
    # ) +
 # color = id
 #    ), 
 #    shape="."
 #    ) +
 color = id
    ), 
    shape="."
    ) +
        

    #scale_color_viridis(discrete=TRUE) +
    #scale_color_brewer(palette="Set1") +
    scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +

    ggtitle (paste0 (rs_name, " - COR num_spp_per_PU vs. Tot out err by Err Class")) +
    theme(plot.title = element_text(hjust = 0.5)) +    #  To center the title

      facet_wrap (~ rsp_combined_err_label, nrow = 2) +
      geom_hline (yintercept = ref_y, linetype="dashed",
                    color = "black", size=0.5) +
      geom_abline (intercept=0, slope=1  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=5  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=10  #, linetype, color, size
                   )
    }

```

```{r}
gg_rsp_num_spp_per_PU_vs_eucOutTot_facetted_by_FN_dominance (rs_name,
                                                   FN_dominant_working_df, 
                                                   ref_y = 0)
```

...  Code hidden for now  ...

```{r, include=FALSE}
#===============================================================================

gg_rsp_correct_solution_cost_vs_eucOutTot_facetted_by_FN_dominance <- function (rs_name,
                                                            sorted_msa_tib,
                                                            ref_y = 0
                                                            , shape_type = "."
                                                            , alpha_level = 1
                                                            )
    {
    ggplot (data = sorted_msa_tib) +
      geom_point (mapping = aes(x = rsp_correct_solution_cost,
                                y = rsr_COR_euc_out_err_frac,
    #                            color = rsp_combined_err_label)) +
    #                             color = id
    # ), 
    # shape="."
    # ) +
 # color = id
 #    ), 
 #    shape="."
 #    ) +
 color = id
    ), 
    shape="."
    ) +
        

    #scale_color_viridis(discrete=TRUE) +
    #scale_color_brewer(palette="Set1") +
    scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +

    ggtitle (paste0 (rs_name, " - COR solution_cost vs. Tot out err by Err Class")) +
    theme(plot.title = element_text(hjust = 0.5)) +    #  To center the title

      facet_wrap (~ rsp_combined_err_label, nrow = 2) +
      geom_hline (yintercept = ref_y, linetype="dashed",
                    color = "black", size=0.5) +
      geom_abline (intercept=0, slope=1  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=5  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=10  #, linetype, color, size
                   )
    }

```

```{r}
gg_rsp_correct_solution_cost_vs_eucOutTot_facetted_by_FN_dominance (rs_name,
                                                   FN_dominant_working_df, 
                                                   ref_y = 0)
```

```{r}
#===============================================================================

gg_sppPUsum_vs_eucOutTot_facetted_by_FN_dominance <- function (rs_name,
                                                            sorted_msa_tib,
                                                            ref_y = 0
                                                            , shape_type = "."
                                                            , alpha_level = 1
                                                            )
    {
    ggplot (data = sorted_msa_tib) +
      geom_point (mapping = aes(x = sppPUsum,
                                y = rsr_COR_euc_out_err_frac,
    #                            color = rsp_combined_err_label)) +
    #                             color = id
    # ), 
    # shape="."
    # ) +
 # color = id
 #    ), 
 #    shape="."
 #    ) +
 color = id
    ), 
    shape="."
    ) +
        

    #scale_color_viridis(discrete=TRUE) +
    #scale_color_brewer(palette="Set1") +
    scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +

    ggtitle (paste0 (rs_name, " - COR sppPUsum vs. Tot out err by Err Class")) +
    theme(plot.title = element_text(hjust = 0.5)) +    #  To center the title

      facet_wrap (~ rsp_combined_err_label, nrow = 2) +
      geom_hline (yintercept = ref_y, linetype="dashed",
                    color = "black", size=0.5) +
      geom_abline (intercept=0, slope=1  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=5  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=10  #, linetype, color, size
                   )
    }

```

```{r}
gg_sppPUsum_vs_eucOutTot_facetted_by_FN_dominance (rs_name,
                                                   FN_dominant_working_df, 
                                                   ref_y = 0)
```


```{r}
#===============================================================================

gg_sppPUprod_vs_eucOutTot_facetted_by_FN_dominance <- function (rs_name,
                                                            sorted_msa_tib,
                                                            ref_y = 0
                                                            , shape_type = "."
                                                            , alpha_level = 1
                                                            )
    {
    ggplot (data = sorted_msa_tib) +
      geom_point (mapping = aes(x = sppPUprod,
                                y = rsr_COR_euc_out_err_frac,
    #                            color = rsp_combined_err_label)) +
    #                             color = id
    # ), 
    # shape="."
    # ) +
 # color = id
 #    ), 
 #    shape="."
 #    ) +
 color = id
    ), 
    shape="."
    ) +
        

    #scale_color_viridis(discrete=TRUE) +
    #scale_color_brewer(palette="Set1") +
    scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +

    ggtitle (paste0 (rs_name, " - COR sppPUprod vs. Tot out err by Err Class")) +
    theme(plot.title = element_text(hjust = 0.5)) +    #  To center the title

      facet_wrap (~ rsp_combined_err_label, nrow = 2) +
      geom_hline (yintercept = ref_y, linetype="dashed",
                    color = "black", size=0.5) +
      geom_abline (intercept=0, slope=1  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=5  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=10  #, linetype, color, size
                   )
    }

```

```{r}
gg_sppPUprod_vs_eucOutTot_facetted_by_FN_dominance (rs_name,
                                                   FN_dominant_working_df, 
                                                   ref_y = 0)
```





##  FP-dominated input errors




```{r}
working_df %>% 
    filter (rsp_combined_err_label == "02-FP_only_NO_cost_err" | 
            rsp_combined_err_label == "05-FP_and_FN_not_matched_NO_cost_err"
) -> FP_dominant_working_df
```





```{r}
#===============================================================================

gg_eucInTot_vs_eucOutTot_facetted_by_FP_dominance <- function (rs_name,
                                                            sorted_msa_tib,
                                                            ref_y = 0
                                                            , shape_type = "."
                                                            , alpha_level = 1
                                                            )
    {
    ggplot (data = sorted_msa_tib) +
      geom_point (mapping = aes(x = rsp_euc_realized_Ftot_and_cost_in_err_frac,
                                y = rsr_COR_euc_out_err_frac,
    #                            color = rsp_combined_err_label)) +
    #                             color = id
    # ), 
    # shape="."
    # ) +
 # color = id
 #    ), 
 #    shape="."
 #    ) +
 color = id
    ), 
    shape="."
    ) +
        

    #scale_color_viridis(discrete=TRUE) +
    #scale_color_brewer(palette="Set1") +
    scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +

    ggtitle (paste0 (rs_name, " - Total input error vs. Tot out err by Err Class")) +
    theme(plot.title = element_text(hjust = 0.5)) +    #  To center the title

      facet_wrap (~ rsp_combined_err_label, nrow = 2) +
      geom_hline (yintercept = ref_y, linetype="dashed",
                    color = "black", size=0.5) +
      geom_abline (intercept=0, slope=1  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=5  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=10  #, linetype, color, size
                   )
    }

#===============================================================================

gg_rsp_realized_FP_rate_vs_eucOutTot_facetted_by_FP_dominance <- function (rs_name,
                                                            sorted_msa_tib,
                                                            ref_y = 0
                                                            , shape_type = "."
                                                            , alpha_level = 1
                                                            )
    {
    ggplot (data = sorted_msa_tib) +
      geom_point (mapping = aes(x = rsp_realized_FP_rate,
                                y = rsr_COR_euc_out_err_frac,
    #                            color = rsp_combined_err_label)) +
    #                             color = id
    # ), 
    # shape="."
    # ) +
 # color = id
 #    ), 
 #    shape="."
 #    ) +
 color = id
    ), 
    shape="."
    ) +
        

    #scale_color_viridis(discrete=TRUE) +
    #scale_color_brewer(palette="Set1") +
    scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +

    ggtitle (paste0 (rs_name, " - Realized FP rate vs. Tot out err by Err Class")) +
    theme(plot.title = element_text(hjust = 0.5)) +    #  To center the title

      facet_wrap (~ rsp_combined_err_label, nrow = 2) +
      geom_hline (yintercept = ref_y, linetype="dashed",
                    color = "black", size=0.5) +
      geom_abline (intercept=0, slope=1  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=5  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=10  #, linetype, color, size
                   )
    }
```

```{r}
gg_eucInTot_vs_eucOutTot_facetted_by_FP_dominance (rs_name,
                                                   FP_dominant_working_df, 
                                                   ref_y = 0)
```

```{r}
gg_rsp_realized_FP_rate_vs_eucOutTot_facetted_by_FP_dominance (rs_name,
                                                   FP_dominant_working_df, 
                                                   ref_y = 0)
```



###  Do things like num_spp predict total output error under FN-dominated error?

```{r}
#===============================================================================

gg_rsp_num_PUs_vs_eucOutTot_facetted_by_FP_dominance <- function (rs_name,
                                                            sorted_msa_tib,
                                                            ref_y = 0
                                                            , shape_type = "."
                                                            , alpha_level = 1
                                                            )
    {
    ggplot (data = sorted_msa_tib) +
      geom_point (mapping = aes(x = rsp_num_PUs,
                                y = rsr_COR_euc_out_err_frac,
    #                            color = rsp_combined_err_label)) +
    #                             color = id
    # ), 
    # shape="."
    # ) +
 # color = id
 #    ), 
 #    shape="."
 #    ) +
 color = id
    ), 
    shape="."
    ) +
        

    #scale_color_viridis(discrete=TRUE) +
    #scale_color_brewer(palette="Set1") +
    scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +

    ggtitle (paste0 (rs_name, " - COR num_PUs vs. Tot out err by Err Class")) +
    theme(plot.title = element_text(hjust = 0.5)) +    #  To center the title

      facet_wrap (~ rsp_combined_err_label, nrow = 2) +
      geom_hline (yintercept = ref_y, linetype="dashed",
                    color = "black", size=0.5) +
      geom_abline (intercept=0, slope=1  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=5  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=10  #, linetype, color, size
                   )
    }
```

```{r}
gg_rsp_num_PUs_vs_eucOutTot_facetted_by_FP_dominance (rs_name,
                                                   FP_dominant_working_df, 
                                                   ref_y = 0)
```


```{r}
#===============================================================================

gg_rsp_num_spp_vs_eucOutTot_facetted_by_FP_dominance <- function (rs_name,
                                                            sorted_msa_tib,
                                                            ref_y = 0
                                                            , shape_type = "."
                                                            , alpha_level = 1
                                                            )
    {
    ggplot (data = sorted_msa_tib) +
      geom_point (mapping = aes(x = rsp_num_spp,
                                y = rsr_COR_euc_out_err_frac,
    #                            color = rsp_combined_err_label)) +
    #                             color = id
    # ), 
    # shape="."
    # ) +
 # color = id
 #    ), 
 #    shape="."
 #    ) +
 color = id
    ), 
    shape="."
    ) +
        

    #scale_color_viridis(discrete=TRUE) +
    #scale_color_brewer(palette="Set1") +
    scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +

    ggtitle (paste0 (rs_name, " - COR num_spp vs. Tot out err by Err Class")) +
    theme(plot.title = element_text(hjust = 0.5)) +    #  To center the title

      facet_wrap (~ rsp_combined_err_label, nrow = 2) +
      geom_hline (yintercept = ref_y, linetype="dashed",
                    color = "black", size=0.5) +
      geom_abline (intercept=0, slope=1  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=5  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=10  #, linetype, color, size
                   )
    }
```

```{r}
gg_rsp_num_spp_vs_eucOutTot_facetted_by_FP_dominance (rs_name,
                                                   FP_dominant_working_df, 
                                                   ref_y = 0)
```

```{r}
#===============================================================================

gg_rsp_num_spp_per_PU_vs_eucOutTot_facetted_by_FP_dominance <- function (rs_name,
                                                            sorted_msa_tib,
                                                            ref_y = 0
                                                            , shape_type = "."
                                                            , alpha_level = 1
                                                            )
    {
    ggplot (data = sorted_msa_tib) +
      geom_point (mapping = aes(x = rsp_num_spp_per_PU,
                                y = rsr_COR_euc_out_err_frac,
    #                            color = rsp_combined_err_label)) +
    #                             color = id
    # ), 
    # shape="."
    # ) +
 # color = id
 #    ), 
 #    shape="."
 #    ) +
 color = id
    ), 
    shape="."
    ) +
        

    #scale_color_viridis(discrete=TRUE) +
    #scale_color_brewer(palette="Set1") +
    scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +

    ggtitle (paste0 (rs_name, " - COR num_spp_per_PU vs. Tot out err by Err Class")) +
    theme(plot.title = element_text(hjust = 0.5)) +    #  To center the title

      facet_wrap (~ rsp_combined_err_label, nrow = 2) +
      geom_hline (yintercept = ref_y, linetype="dashed",
                    color = "black", size=0.5) +
      geom_abline (intercept=0, slope=1  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=5  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=10  #, linetype, color, size
                   )
    }
```

```{r}
gg_rsp_num_spp_per_PU_vs_eucOutTot_facetted_by_FP_dominance (rs_name,
                                                   FP_dominant_working_df, 
                                                   ref_y = 0)
```

```{r}
#===============================================================================

gg_rsp_correct_solution_cost_vs_eucOutTot_facetted_by_FP_dominance <- function (rs_name,
                                                            sorted_msa_tib,
                                                            ref_y = 0
                                                            , shape_type = "."
                                                            , alpha_level = 1
                                                            )
    {
    ggplot (data = sorted_msa_tib) +
      geom_point (mapping = aes(x = rsp_correct_solution_cost,
                                y = rsr_COR_euc_out_err_frac,
    #                            color = rsp_combined_err_label)) +
    #                             color = id
    # ), 
    # shape="."
    # ) +
 # color = id
 #    ), 
 #    shape="."
 #    ) +
 color = id
    ), 
    shape="."
    ) +
        

    #scale_color_viridis(discrete=TRUE) +
    #scale_color_brewer(palette="Set1") +
    scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +

    ggtitle (paste0 (rs_name, " - COR correct_solution_cost vs. Tot out err by Err Class")) +
    theme(plot.title = element_text(hjust = 0.5)) +    #  To center the title

      facet_wrap (~ rsp_combined_err_label, nrow = 2) +
      geom_hline (yintercept = ref_y, linetype="dashed",
                    color = "black", size=0.5) +
      geom_abline (intercept=0, slope=1  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=5  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=10  #, linetype, color, size
                   )
    }
```

```{r}
gg_rsp_correct_solution_cost_vs_eucOutTot_facetted_by_FP_dominance (rs_name,
                                                   FP_dominant_working_df, 
                                                   ref_y = 0)
```

```{r}
#===============================================================================

gg_sppPUsum_vs_eucOutTot_facetted_by_FP_dominance <- function (rs_name,
                                                            sorted_msa_tib,
                                                            ref_y = 0
                                                            , shape_type = "."
                                                            , alpha_level = 1
                                                            )
    {
    ggplot (data = sorted_msa_tib) +
      geom_point (mapping = aes(x = sppPUsum,
                                y = rsr_COR_euc_out_err_frac,
    #                            color = rsp_combined_err_label)) +
    #                             color = id
    # ), 
    # shape="."
    # ) +
 # color = id
 #    ), 
 #    shape="."
 #    ) +
 color = id
    ), 
    shape="."
    ) +
        

    #scale_color_viridis(discrete=TRUE) +
    #scale_color_brewer(palette="Set1") +
    scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +

    ggtitle (paste0 (rs_name, " - COR sppPUsum vs. Tot out err by Err Class")) +
    theme(plot.title = element_text(hjust = 0.5)) +    #  To center the title

      facet_wrap (~ rsp_combined_err_label, nrow = 2) +
      geom_hline (yintercept = ref_y, linetype="dashed",
                    color = "black", size=0.5) +
      geom_abline (intercept=0, slope=1  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=5  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=10  #, linetype, color, size
                   )
    }
```

```{r}
gg_sppPUsum_vs_eucOutTot_facetted_by_FP_dominance (rs_name,
                                                   FP_dominant_working_df, 
                                                   ref_y = 0)
```


```{r}
#===============================================================================

gg_sppPUprod_vs_eucOutTot_facetted_by_FP_dominance <- function (rs_name,
                                                            sorted_msa_tib,
                                                            ref_y = 0
                                                            , shape_type = "."
                                                            , alpha_level = 1
                                                            )
    {
    ggplot (data = sorted_msa_tib) +
      geom_point (mapping = aes(x = sppPUprod,
                                y = rsr_COR_euc_out_err_frac,
    #                            color = rsp_combined_err_label)) +
    #                             color = id
    # ), 
    # shape="."
    # ) +
 # color = id
 #    ), 
 #    shape="."
 #    ) +
 color = id
    ), 
    shape="."
    ) +
        

    #scale_color_viridis(discrete=TRUE) +
    #scale_color_brewer(palette="Set1") +
    scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +

    ggtitle (paste0 (rs_name, " - COR sppPUprod vs. Tot out err by Err Class")) +
    theme(plot.title = element_text(hjust = 0.5)) +    #  To center the title

      facet_wrap (~ rsp_combined_err_label, nrow = 2) +
      geom_hline (yintercept = ref_y, linetype="dashed",
                    color = "black", size=0.5) +
      geom_abline (intercept=0, slope=1  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=5  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=10  #, linetype, color, size
                   )
    }
```

```{r}
gg_sppPUprod_vs_eucOutTot_facetted_by_FP_dominance (rs_name,
                                                   FP_dominant_working_df, 
                                                   ref_y = 0)
```
















##  Different types of output error

### Ascelin's comment about how much effort is each RS putting into getting the tail end of the species

- I think that I do have a kind of record of that in the cumulative plots I was putting out showing fraction of species covered on x and number of patches included (cost) on y.  I think those plots are still being generated.  Need to look.  It may be that some of them have an elbow that could be identified, but if there's no elbow, the choice of cutoff becomes more arbitrary.  
- Other possibilities might be:
    - fraction of species covered by only spending the optimal cost (i.e., consider that the budget)
    - fraction of species covered at various quantiles of cost (e.g., 90, 95, 99)
    - fraction of optimal cost for various quantiles of fraction of spp covered  (e.g., 90, 95, 99)
    - or just a simple invocation of the 80/20 rule in some way
        - I think that at one point, I was calculating the cost per spp covered at each step in the purchase sequence, but the maximum value of that occurs at the start of the process, so it's not that helpful  
        - then again, you could start throwing out PUs based on unprotected richness or something until you get down to the budget  
- One issue here is that when the non-greedy reserve selectors are running on the apparent data, they don't give you an ordering of the PUs and they're making mistakes _because_ they don't know they're making them, so you can only do some sort of correct pruning if you do know the correct answer.
        

###  Decompose output errors into over/under, etc

I've tracked the overcost and undercost and the underrepresentation (shortfall).  Maybe these can partly get at what Ascelin was asking about.  

#### Results and their errors  

- rs_solution_cost_err_frac 
- abs_rs_solution_cost_err_frac 

- rsr_COR_spp_rep_shortfall 
- rsr_COR_solution_FRAC_spp_covered 

```{r funcsGgplotSignedErrFracsAndRepShortfalls, include=FALSE}
#===============================================================================

gg_eucInTot_vs_signedCostErrFrac_all_on_1 <- function (rs_name,
                                               sorted_msa_tib,
                                               ref_y = 0)
    {
    ggplot (data = sorted_msa_tib) +
            aes(x = rsp_euc_realized_Ftot_and_cost_in_err_frac,
                                        y = rs_solution_cost_err_frac, #rsr_COR_euc_out_err_frac,
            #                            color = rsp_combined_err_label)) +
                                        color = id) +
#            geom_point() +
        geom_point(shape=".") +
        
            scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +
            stat_smooth(method = "lm", col = "green") +
    
        # ggplot (data = sorted_msa_tib) +
        #       geom_point (mapping = ) +
        #     #scale_color_viridis(discrete=TRUE) +
        #     scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +
        #
            ggtitle (paste0 (rs_name, " - Total input error vs. Signed cost err frac"    #Total output error"
                             )) +
            theme(plot.title = element_text(hjust = 0.5)) +    #  To center the title
    
              geom_hline (yintercept = ref_y, linetype="dashed",
                            color = "black", size=0.5) +
              geom_abline (intercept=0, slope=1  #, linetype, color, size
                           ) +
              geom_abline (intercept=0, slope=5  #, linetype, color, size
                           ) +
              geom_abline (intercept=0, slope=10  #, linetype, color, size
                           )
    }

#===============================================================================

gg_eucInTot_vs_signedCostErrFrac_facetted_by_err_label <- function (rs_name,
                                                            sorted_msa_tib,
                                                            ref_y = 0)
    {
    ggplot (data = sorted_msa_tib) +
      geom_point (mapping = aes(x = rsp_euc_realized_Ftot_and_cost_in_err_frac,
                                y = rs_solution_cost_err_frac,
    #                            color = rsp_combined_err_label)) +
    #                             color = id
    # ,
    # shape="."
    # )) +
# color = id
#     ), 
#     shape="."
#     ) +
 color = id
    ), 
    shape="."
    ) +

    #scale_color_viridis(discrete=TRUE) +
    #scale_color_brewer(palette="Set1") +
    scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +

    ggtitle (paste0 (rs_name, " - Total input error vs. Signed cost err frac by Error Class")) +
    theme(plot.title = element_text(hjust = 0.5)) +    #  To center the title

      facet_wrap (~ rsp_combined_err_label, nrow = 5) +
      geom_hline (yintercept = ref_y, linetype="dashed",
                    color = "black", size=0.5) +
      geom_abline (intercept=0, slope=1  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=5  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=10  #, linetype, color, size
                   )
    }


#===============================================================================

gg_eucInTot_vs_sppRepShortfall_all_on_1 <- function (rs_name,
                                               sorted_msa_tib,
                                               ref_y = 0)
    {
    ggplot (data = sorted_msa_tib) +
            aes(x = rsp_euc_realized_Ftot_and_cost_in_err_frac,
                                        y = rsr_COR_spp_rep_shortfall, #rsr_COR_euc_out_err_frac,
            #                            color = rsp_combined_err_label)) +
#                                         color = id
#         ,
#         shape="."
#         ) +
# ##            geom_point() +
# #        geom_point(shape=".") +

                                    color = id) +
        geom_point(shape=".", alpha=1) +

    
            scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +
            stat_smooth(method = "lm", col = "green") +
    
        # ggplot (data = sorted_msa_tib) +
        #       geom_point (mapping = ) +
        #     #scale_color_viridis(discrete=TRUE) +
        #     scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +
        #
            ggtitle (paste0 (rs_name, " - Total input error vs. Spp Rep Shortfall"    #Total output error"
                             )) +
            theme(plot.title = element_text(hjust = 0.5)) +    #  To center the title
    
              geom_hline (yintercept = ref_y, linetype="dashed",
                            color = "black", size=0.5) +
              geom_abline (intercept=0, slope=1  #, linetype, color, size
                           ) +
              geom_abline (intercept=0, slope=5  #, linetype, color, size
                           ) +
              geom_abline (intercept=0, slope=10  #, linetype, color, size
                           )
    }

#===============================================================================

gg_eucInTot_vs_sppRepShortfall_facetted_by_err_label <- function (rs_name,
                                                            sorted_msa_tib,
                                                            ref_y = 0)
    {
    ggplot (data = sorted_msa_tib) +
      geom_point (mapping = aes(x = rsp_euc_realized_Ftot_and_cost_in_err_frac,
                                y = rsr_COR_spp_rep_shortfall,
    #                            color = rsp_combined_err_label)) +
    #                             color = id
    # , 
    # shape="."
    # )) +
# color = id
#     ), 
#     shape="."
#     ) +
 color = id
    ), 
    shape="."
    ) +

    #scale_color_viridis(discrete=TRUE) +
    #scale_color_brewer(palette="Set1") +
    scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +

    ggtitle (paste0 (rs_name, " - Total input error vs. Spp Rep Shortfall by Error Class")) +
    theme(plot.title = element_text(hjust = 0.5)) +    #  To center the title

      facet_wrap (~ rsp_combined_err_label, nrow = 5) +
      geom_hline (yintercept = ref_y, linetype="dashed",
                    color = "black", size=0.5) +
      geom_abline (intercept=0, slope=1  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=5  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=10  #, linetype, color, size
                   )
    }
```

```{r ggplotSignedErrFracsAndRepShortfalls}

#--  rs_solution_cost_err_frac

#####gg_eucInTot_vs_signedCostErrFrac_all_on_1 (rs_name, easyHard_df, ref_y = 0)
#####gg_eucInTot_vs_signedCostErrFrac_facetted_by_err_label (rs_name, easyHard_df, ref_y = 0)
# easyHard_df %>% 
#     filter (rsr_COR_euc_out_err_frac <= 1) -> not_huge_out_err_df
#####gg_eucInTot_vs_signedCostErrFrac_all_on_1 (rs_name, easyHard_not_huge_out_err_df, ref_y = 0)
#####gg_eucInTot_vs_signedCostErrFrac_facetted_by_err_label (rs_name, easyHard_not_huge_out_err_df, ref_y = 0)

gg_eucInTot_vs_signedCostErrFrac_all_on_1 (rs_name, working_df, ref_y = 0)
gg_eucInTot_vs_signedCostErrFrac_facetted_by_err_label (rs_name, working_df, ref_y = 0)
# working_df %>% 
#     filter (rsr_COR_euc_out_err_frac <= 1) -> not_huge_out_err_df
#####gg_eucInTot_vs_signedCostErrFrac_all_on_1 (rs_name, working_not_huge_out_err_df, ref_y = 0)
#####gg_eucInTot_vs_signedCostErrFrac_facetted_by_err_label (rs_name, working_not_huge_out_err_df, ref_y = 0)

#--  rsr_COR_spp_rep_shortfall 

#####gg_eucInTot_vs_sppRepShortfall_all_on_1 (rs_name, easyHard_df, ref_y = 0)
#####gg_eucInTot_vs_sppRepShortfall_facetted_by_err_label (rs_name, easyHard_df, ref_y = 0)
# easyHard_df %>% 
#     filter (rsr_COR_euc_out_err_frac <= 1) -> not_huge_out_err_df
#####gg_eucInTot_vs_sppRepShortfall_all_on_1 (rs_name, easyHard_not_huge_out_err_df, ref_y = 0)
#####gg_eucInTot_vs_sppRepShortfall_facetted_by_err_label (rs_name, easyHard_not_huge_out_err_df, ref_y = 0)

gg_eucInTot_vs_sppRepShortfall_all_on_1 (rs_name, working_df, ref_y = 0)
gg_eucInTot_vs_sppRepShortfall_facetted_by_err_label (rs_name, working_df, ref_y = 0)
# working_df %>% 
#     filter (rsr_COR_euc_out_err_frac <= 1) -> working_not_huge_out_err_df
#####gg_eucInTot_vs_sppRepShortfall_all_on_1 (rs_name, working_not_huge_out_err_df, ref_y = 0)
#####gg_eucInTot_vs_sppRepShortfall_facetted_by_err_label (rs_name, working_not_huge_out_err_df, ref_y = 0)
```

####  Spp rep shortfall vs. Signed cost error

```{r funcsGgplotRepShortfallVsSignedErrFracs, include=FALSE}
#===============================================================================

gg_sppRepShortfall_vs_signedCostErrFrac_all_on_1 <- function (rs_name,
                                               sorted_msa_tib,
                                               ref_y = 0)
    {
    ggplot (data = sorted_msa_tib) +
            aes(x = rsr_COR_spp_rep_shortfall,
                                        y = rs_solution_cost_err_frac, #rsr_COR_euc_out_err_frac,
            #                            color = rsp_combined_err_label)) +
#                                         color = id
#             ,
#             shape="."
#             ) +
# #            geom_point() +
# #        geom_point(shape=".") +


            #                            color = rsp_combined_err_label)) +
#                                         color = id
#         ,
#         shape="."
#         ) +
# ##            geom_point() +
# #        geom_point(shape=".") +

                                    color = id) +
        geom_point(shape=".", alpha=1) +

    

            scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +
            stat_smooth(method = "lm", col = "green") +
    
        # ggplot (data = sorted_msa_tib) +
        #       geom_point (mapping = ) +
        #     #scale_color_viridis(discrete=TRUE) +
        #     scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +
        #
            ggtitle (paste0 (rs_name, " - Spp Rep Shortfall vs. Signed cost err frac"    #Total output error"
                             )) +
            theme(plot.title = element_text(hjust = 0.5)) +    #  To center the title
    
              geom_hline (yintercept = ref_y, linetype="dashed",
                            color = "black", size=0.5) +
              geom_abline (intercept=0, slope=1  #, linetype, color, size
                           ) +
              geom_abline (intercept=0, slope=5  #, linetype, color, size
                           ) +
              geom_abline (intercept=0, slope=10  #, linetype, color, size
                           )
    }

#===============================================================================

gg_sppRepShortfall_vs_signedCostErrFrac_facetted_by_err_label <- function (rs_name,
                                                            sorted_msa_tib,
                                                            ref_y = 0)
    {
    ggplot (data = sorted_msa_tib) +
      geom_point (mapping = aes(x = rsr_COR_spp_rep_shortfall,
                                y = rs_solution_cost_err_frac,
    #                            color = rsp_combined_err_label)) +
    #                             color = id
    # ,
    # shape="."
    # )) +
 # color = id
 #    ), 
 #    shape="."
 #    ) +
 color = id
    ), 
    shape="."
    ) +
        
#        geom_point(shape=".") +
        
    #scale_color_viridis(discrete=TRUE) +
    #scale_color_brewer(palette="Set1") +
    scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +

    ggtitle (paste0 (rs_name, " - Spp Rep Shortfall vs. Signed cost err frac by Error Class")) +
    theme(plot.title = element_text(hjust = 0.5)) +    #  To center the title

      facet_wrap (~ rsp_combined_err_label, nrow = 5) +
      geom_hline (yintercept = ref_y, linetype="dashed",
                    color = "black", size=0.5) +
      geom_abline (intercept=0, slope=1  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=5  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=10  #, linetype, color, size
                   )
    }
```

```{r GgplotRepShortfallVsSignedErrFracs}

#--  rs_solution_cost_err_frac

#####gg_sppRepShortfall_vs_signedCostErrFrac_all_on_1 (rs_name, easyHard_df, ref_y = 0)
#####gg_sppRepShortfall_vs_signedCostErrFrac_facetted_by_err_label (rs_name, easyHard_df, ref_y = 0)
# easyHard_df %>% 
#     filter (rsr_COR_euc_out_err_frac <= 1) -> not_huge_out_err_df
#####gg_sppRepShortfall_vs_signedCostErrFrac_all_on_1 (rs_name, easyHard_not_huge_out_err_df, ref_y = 0)
#####gg_sppRepShortfall_vs_signedCostErrFrac_facetted_by_err_label (rs_name, easyHard_not_huge_out_err_df, ref_y = 0)

gg_sppRepShortfall_vs_signedCostErrFrac_all_on_1 (rs_name, working_df, ref_y = 0)
gg_sppRepShortfall_vs_signedCostErrFrac_facetted_by_err_label (rs_name, working_df, ref_y = 0)
# working_df %>% 
#     filter (rsr_COR_euc_out_err_frac <= 1) -> not_huge_out_err_df
#####gg_sppRepShortfall_vs_signedCostErrFrac_all_on_1 (rs_name, working_not_huge_out_err_df, ref_y = 0)
#####gg_sppRepShortfall_vs_signedCostErrFrac_facetted_by_err_label (rs_name, working_not_huge_out_err_df, ref_y = 0)

#--  rsr_COR_spp_rep_shortfall 

#####gg_eucInTot_vs_sppRepShortfall_all_on_1 (rs_name, easyHard_df, ref_y = 0)
#####gg_eucInTot_vs_sppRepShortfall_facetted_by_err_label (rs_name, easyHard_df, ref_y = 0)
# easyHard_df %>% 
#     filter (rsr_COR_euc_out_err_frac <= 1) -> not_huge_out_err_df
#####gg_eucInTot_vs_sppRepShortfall_all_on_1 (rs_name, easyHard_not_huge_out_err_df, ref_y = 0)
#####gg_eucInTot_vs_sppRepShortfall_facetted_by_err_label (rs_name, easyHard_not_huge_out_err_df, ref_y = 0)

gg_eucInTot_vs_sppRepShortfall_all_on_1 (rs_name, working_df, ref_y = 0)
gg_eucInTot_vs_sppRepShortfall_facetted_by_err_label (rs_name, working_df, ref_y = 0)
# working_df %>% 
#     filter (rsr_COR_euc_out_err_frac <= 1) -> not_huge_out_err_df
#####gg_eucInTot_vs_sppRepShortfall_all_on_1 (rs_name, working_not_huge_out_err_df, ref_y = 0)
#####gg_eucInTot_vs_sppRepShortfall_facetted_by_err_label (rs_name, working_not_huge_out_err_df, ref_y = 0)
```

#### Also look at problem of putting errors on equal footing, i.e., how much error is _possible_

I've also tracked the _fraction of possible_ overcost and undercost as a way of trying to put problems on a more equal footing.  

- Overcost:  

    - The largest possible error is related to what fraction of the landscape is required in the optimal solution.  If the optimal solution takes up most of the landscape, then only a tiny overcost is possible.    
    - max overcost error = (total landscape cost - optimal cost) / optimal cost    
    -                    = (total landscape cost / optimal cost) - 1    
    
- Undercost:  

    - In all cases, the undercost is bounded by 100%, since the error is a fraction of the optimal cost and costs can't go less than 0 and once you hit 0 cost error is 100%.    
    - max undercost error = (optimal cost - min cost possible) / optimal cost    
    -                     = (optimal cost - 0) / optimal cost = 1    


#### Results and their errors  

- rs_over_opt_cost_err_frac_of_possible_overcost 
- rs_under_opt_cost_err_frac_of_possible_undercost 

```{r funcsForGgplotPossibleErrorFracs, include=FALSE}
#===============================================================================

gg_eucInTot_vs_fracPossibleOver_all_on_1 <- function (rs_name,
                                               sorted_msa_tib,
                                               ref_y = 0)
    {
    
# - rs_solution_cost_err_frac 
# - abs_rs_solution_cost_err_frac 
# 
# - rs_over_opt_cost_err_frac_of_possible_overcost 
# - rs_under_opt_cost_err_frac_of_possible_undercost 
# 
# - rsr_COR_spp_rep_shortfall 
# - rsr_COR_solution_FRAC_spp_covered 

    
    
    ggplot (data = sorted_msa_tib) +
            aes(x = rsp_euc_realized_Ftot_and_cost_in_err_frac,
                                        y = rs_over_opt_cost_err_frac_of_possible_overcost, #rsr_COR_euc_out_err_frac,
            #                            color = rsp_combined_err_label)) +
#                                         color = id
#             ,
#             shape="."
#             ) +
# #            geom_point() +
# #        geom_point(shape=".") +


             #                            color = rsp_combined_err_label)) +
#                                         color = id
#         ,
#         shape="."
#         ) +
# ##            geom_point() +
# #        geom_point(shape=".") +

                                    color = id) +
        geom_point(shape=".", alpha=1) +

    

            scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +
            stat_smooth(method = "lm", col = "green") +
    
        # ggplot (data = sorted_msa_tib) +
        #       geom_point (mapping = ) +
        #     #scale_color_viridis(discrete=TRUE) +
        #     scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +
        #
            ggtitle (paste0 (rs_name, " - Total input error vs. Over err frac of possible"    #Total output error"
                             )) +
            theme(plot.title = element_text(hjust = 0.5)) +    #  To center the title
    
              geom_hline (yintercept = ref_y, linetype="dashed",
                            color = "black", size=0.5) +
              geom_abline (intercept=0, slope=1  #, linetype, color, size
                           ) +
              geom_abline (intercept=0, slope=5  #, linetype, color, size
                           ) +
              geom_abline (intercept=0, slope=10  #, linetype, color, size
                           )
    }

#===============================================================================

gg_eucInTot_vs_fracPossibleOver_facetted_by_err_label <- function (rs_name,
                                                            sorted_msa_tib,
                                                            ref_y = 0)
    {
    ggplot (data = sorted_msa_tib) +
      geom_point (mapping = aes(x = rsp_euc_realized_Ftot_and_cost_in_err_frac,
                                y = rs_over_opt_cost_err_frac_of_possible_overcost,
    #                            color = rsp_combined_err_label)) +
    #                             color = id
    # ,
    # shape="."
    # )) +
    # color = id
    # ), 
    # shape="."
    # ) +
 color = id
    ), 
    shape="."
    ) +
        
        
     
#        geom_point(shape=".") +

    #scale_color_viridis(discrete=TRUE) +
    #scale_color_brewer(palette="Set1") +
    scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +

    ggtitle (paste0 (rs_name, " - Total input error vs. Over err frac of possible by Error Class")) +
    theme(plot.title = element_text(hjust = 0.5)) +    #  To center the title

      facet_wrap (~ rsp_combined_err_label, nrow = 5) +
      geom_hline (yintercept = ref_y, linetype="dashed",
                    color = "black", size=0.5) +
      geom_abline (intercept=0, slope=1  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=5  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=10  #, linetype, color, size
                   )
    }

#===============================================================================

gg_eucInTot_vs_fracPossibleUnder_all_on_1 <- function (rs_name,
                                               sorted_msa_tib,
                                               ref_y = 0)
    {
    
# - rs_solution_cost_err_frac 
# - abs_rs_solution_cost_err_frac 
# 
# - rs_over_opt_cost_err_frac_of_possible_overcost 
# - rs_under_opt_cost_err_frac_of_possible_undercost 
# 
# - rsr_COR_spp_rep_shortfall 
# - rsr_COR_solution_FRAC_spp_covered 

    
    
    ggplot (data = sorted_msa_tib) +
            aes(x = rsp_euc_realized_Ftot_and_cost_in_err_frac,
                                        y = rs_under_opt_cost_err_frac_of_possible_undercost, #rsr_COR_euc_out_err_frac,
            #                            color = rsp_combined_err_label)) +
#                                         color = id
#             ,
#             shape="."
#             ) +
# #            geom_point() +
# #        geom_point(shape=".") +


            #                            color = rsp_combined_err_label)) +
#                                         color = id
#         ,
#         shape="."
#         ) +
# ##            geom_point() +
# #        geom_point(shape=".") +

                                    color = id) +
        geom_point(shape=".", alpha=1) +

    

            scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +
            stat_smooth(method = "lm", col = "green") +
    
        # ggplot (data = sorted_msa_tib) +
        #       geom_point (mapping = ) +
        #     #scale_color_viridis(discrete=TRUE) +
        #     scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +
        #
            ggtitle (paste0 (rs_name, " - Total input error vs. Under err frac of possible"    #Total output error"
                             )) +
            theme(plot.title = element_text(hjust = 0.5)) +    #  To center the title
    
              geom_hline (yintercept = ref_y, linetype="dashed",
                            color = "black", size=0.5) +
              geom_abline (intercept=0, slope=1  #, linetype, color, size
                           ) +
              geom_abline (intercept=0, slope=5  #, linetype, color, size
                           ) +
              geom_abline (intercept=0, slope=10  #, linetype, color, size
                           )
    }

#===============================================================================

gg_eucInTot_vs_fracPossibleUnder_facetted_by_err_label <- function (rs_name,
                                                            sorted_msa_tib,
                                                            ref_y = 0)
    {
    ggplot (data = sorted_msa_tib) +
      geom_point (mapping = aes(x = rsp_euc_realized_Ftot_and_cost_in_err_frac,
                                y = rs_under_opt_cost_err_frac_of_possible_undercost,
    #                            color = rsp_combined_err_label)) +
    #                             color = id
    # ,
    # shape="."
    # )) +
 # color = id
 #    ), 
 #    shape="."
 #    ) +
 color = id
    ), 
    shape="."
    ) +
        
        
#        geom_point(shape=".") +

    #scale_color_viridis(discrete=TRUE) +
    #scale_color_brewer(palette="Set1") +
    scale_color_manual(breaks = c("B1", "B2"), values=c("blue", "red")) +

    ggtitle (paste0 (rs_name, " - Total input error vs. Under err frac of possible by Error Class")) +
    theme(plot.title = element_text(hjust = 0.5)) +    #  To center the title

      facet_wrap (~ rsp_combined_err_label, nrow = 5) +
      geom_hline (yintercept = ref_y, linetype="dashed",
                    color = "black", size=0.5) +
      geom_abline (intercept=0, slope=1  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=5  #, linetype, color, size
                   ) +
      geom_abline (intercept=0, slope=10  #, linetype, color, size
                   )
    }
```

```{r ggplotPossibleErrorFracs}

#--  OVER cost frac possible

#####gg_eucInTot_vs_fracPossibleOver_all_on_1 (rs_name, easyHard_df, ref_y = 0)
#####gg_eucInTot_vs_fracPossibleOver_facetted_by_err_label (rs_name, easyHard_df, ref_y = 0)
# easyHard_df %>% 
#     filter (rsr_COR_euc_out_err_frac <= 1) -> not_huge_out_err_df
#####gg_eucInTot_vs_fracPossibleOver_all_on_1 (rs_name, easyHard_not_huge_out_err_df, ref_y = 0)
#####gg_eucInTot_vs_fracPossibleOver_facetted_by_err_label (rs_name, easyHard_not_huge_out_err_df, ref_y = 0)

gg_eucInTot_vs_fracPossibleOver_all_on_1 (rs_name, working_df, ref_y = 0)
gg_eucInTot_vs_fracPossibleOver_facetted_by_err_label (rs_name, working_df, ref_y = 0)
# working_df %>% 
#     filter (rsr_COR_euc_out_err_frac <= 1) -> not_huge_out_err_df
#####gg_eucInTot_vs_fracPossibleOver_all_on_1 (rs_name, working_not_huge_out_err_df, ref_y = 0)
#####gg_eucInTot_vs_fracPossibleOver_facetted_by_err_label (rs_name, working_not_huge_out_err_df, ref_y = 0)

#--  UNDER cost frac possible

#####gg_eucInTot_vs_fracPossibleUnder_all_on_1 (rs_name, easyHard_df, ref_y = 0)
#####gg_eucInTot_vs_fracPossibleUnder_facetted_by_err_label (rs_name, easyHard_df, ref_y = 0)
# easyHard_df %>% 
#     filter (rsr_COR_euc_out_err_frac <= 1) -> not_huge_out_err_df
#####gg_eucInTot_vs_fracPossibleUnder_all_on_1 (rs_name, easyHard_not_huge_out_err_df, ref_y = 0)
#####gg_eucInTot_vs_fracPossibleUnder_facetted_by_err_label (rs_name, easyHard_not_huge_out_err_df, ref_y = 0)

gg_eucInTot_vs_fracPossibleUnder_all_on_1 (rs_name, working_df, ref_y = 0)
gg_eucInTot_vs_fracPossibleUnder_facetted_by_err_label (rs_name, working_df, ref_y = 0)
# working_df %>% 
#     filter (rsr_COR_euc_out_err_frac <= 1) -> not_huge_out_err_df
#####gg_eucInTot_vs_fracPossibleUnder_all_on_1 (rs_name, working_not_huge_out_err_df, ref_y = 0)
#####gg_eucInTot_vs_fracPossibleUnder_facetted_by_err_label (rs_name, working_not_huge_out_err_df, ref_y = 0)


```

----------------------------

----------------------------

#  Compute correlations among primary working data variables

```{r computeAllCorrs}
#library (corrplot)
```

##  Old version before timings and bipartite measures

```{r selectOldCorrs}
    #  Compute correlation matrix after stripping out non-continuous 
    #  variables.
continuous_vars_working_df = 
    select (working_df, #c (
            
                    #  Input descriptors
                    rsp_num_PUs, 
                    rsp_num_spp, 
                    rsp_num_spp_per_PU, 
                    rsp_correct_solution_cost, 
            
                    sppPUsum,
                    sppPUprod, 
            
            #  Post-gen knowable problem descriptors
            
                #  Species and PU counts
                        # rsp_app_num_spp, 
                        # rsp_app_num_PUs, 
                    
                #  igraph package metrics
    #                ig_rsp_UUID, 
            
                        # ig_top, 
                        # ig_bottom, 
                        # ig_num_edges_m, 
                        # ig_ktop, 
                        # ig_kbottom, 
                        # ig_bidens, 
                        # ig_lcctop, 
                        # ig_lccbottom, 
                        # ig_distop, 
                        # ig_disbottom, 
                        # ig_cctop, 
                        # ig_ccbottom, 
                        # ig_cclowdottop, 
                        # ig_cclowdotbottom, 
                        # ig_cctopdottop, 
                        # ig_cctopdotbottom, 
                    ig_mean_bottom_bg_redundancy, 
                    ig_median_bottom_bg_redundancy, 
                    ig_mean_top_bg_redundancy, 
                    ig_median_top_bg_redundancy, 
                    
                    # ig_user_time, 
                    # ig_system_time, 
                    # ig_elapsed_time, 
                    # ig_user_child_time, 
                    # ig_sys_child_time, 
                                    
                #  bipartite package metrics
    #                bip_rsp_UUID, 
            
                    connectance, 
                            # number.of.PUs, 
                            # number.of.Spp, 
                    
                    # bip_user_time, 
                    # bip_system_time, 
                    # bip_elapsed_time, 
                    # bip_user_child_time, 
                    # bip_sys_child_time, 
    
    
                #  Possibly knowable realized input error values
                            # rsp_realized_median_abs_cost_err_frac, 
                            # rsp_realized_mean_abs_cost_err_frac, 
                            # rsp_realized_sd_abs_cost_err_frac, 
                            # rsp_FP_const_rate, 
                            # rsp_FN_const_rate, 
                    
                    rsp_realized_FP_rate, 
                    rsp_realized_FN_rate, 
                    rsp_realized_Ftot_rate, 
                    rsp_euc_realized_FP_and_cost_in_err_frac, 
                    rsp_euc_realized_FN_and_cost_in_err_frac, 
                    rsp_euc_realized_Ftot_and_cost_in_err_frac, 
                    
#                        rsp_wrap_is_imperfect,
                            
    
                #  Results and their errors
                            # rs_solution_cost, 
                            # rs_solution_cost_err_frac, 
                            # abs_rs_solution_cost_err_frac, 
                            # 
                            # rs_over_opt_cost_err_frac_of_possible_overcost, 
                            # rs_under_opt_cost_err_frac_of_possible_undercost, 
                            # 
                    err_mag, 
                    rsr_COR_euc_out_err_frac
                            # 
                            # rsr_COR_spp_rep_shortfall, 
                            # rsr_COR_solution_NUM_spp_covered, 
                            # rsr_COR_solution_FRAC_spp_covered, 
    )

correlations = cor (continuous_vars_working_df)

num_corr_cols = ncol (correlations)
correlations [, num_corr_cols-1 : num_corr_cols]
```


```{r plotOldCorrs}
    #  Plot the correlation matrix.

corrplot (correlations, tl.cex=0.5
#          , order = "hclust"    #  This fails because of NAs or NaNs in the data...
          )
```

##  Revised set of variables to examine for correlations

###  Compute correlations of size vars with output error and magnification

```{r}
size_vars_working_df = 
    select (working_df, #c (

            #  Input descriptors
                    rsp_num_PUs, 
                    rsp_num_spp, 
                    rsp_num_spp_per_PU, 
                    rsp_correct_solution_cost, 
            
                    sppPUsum,
                    sppPUprod, 
            
                #  Results and their errors
                    err_mag, 
                    rsr_COR_euc_out_err_frac
                      )

correlations = cor (size_vars_working_df)
```

```{r}
num_corr_cols = ncol (correlations)
print (correlations [, (num_corr_cols-1) : num_corr_cols])
```

```{r}
    #  Plot the correlation matrix.

corrplot (correlations, tl.cex=0.5
#          , order = "hclust"    #  This fails because of NAs or NaNs in the data...
          )
```


###  Compute correlations of igraph metrics with output error and magnification

```{r}
igraph_vars_working_df = 
    select (working_df, #c (

                #  igraph package metrics
                    ig_top, 
                    ig_bottom, 
                    ig_num_edges_m, 
                    ig_ktop, 
                    ig_kbottom, 
                    ig_bidens, 
                    ig_lcctop, 
                    ig_lccbottom, 
                    ig_distop, 
                    ig_disbottom, 
                    ig_cctop, 
                    ig_ccbottom, 
                    ig_cclowdottop, 
                    ig_cclowdotbottom, 
                    ig_cctopdottop, 
                    ig_cctopdotbottom, 
                    
                    ig_mean_bottom_bg_redundancy, 
                    ig_median_bottom_bg_redundancy, 
                    ig_mean_top_bg_redundancy, 
                    ig_median_top_bg_redundancy, 
                    
                    err_mag, 
                    rsr_COR_euc_out_err_frac, 
                      )

correlations = cor (igraph_vars_working_df)
```

```{r}
num_corr_cols = ncol (correlations)
print (correlations [, (num_corr_cols-1) : num_corr_cols])
```

```{r}
    #  Plot the correlation matrix.

corrplot (correlations, tl.cex=0.5
#          , order = "hclust"    #  This fails because of NAs or NaNs in the data...
          )
```

###  Compute correlations of igraph metrics with output error and magnification

```{r}
bipartite_vars_working_df = 
    select (working_df, #c (

                #  bipartite package metrics
                    connectance, 
        
                    web_asymmetry,
                    links_per_PUsAndSpp,
                    cluster_coefficient,
                    weighted_NODF,
                    interaction_strength_asymmetry,
                    specialisation_asymmetry,
                    linkage_density,
                    weighted_connectance,
                    Shannon_diversity,
                    interaction_evenness,
                    Alatalo_interaction_evenness,
    
                    mean.number.of.shared.partners.PUs,
                    mean.number.of.shared.partners.Spp,
                    cluster.coefficient.PUs,
                    cluster.coefficient.Spp,
                    niche.overlap.PUs,
                    niche.overlap.Spp,
                    togetherness.PUs,
                    togetherness.Spp,
                    C.score.PUs,
                    C.score.Spp,
                    V.ratio.PUs,
                    V.ratio.Spp,
                    functional.complementarity.PUs,
                    functional.complementarity.Spp,
                    partner.diversity.PUs,
                    partner.diversity.Spp,
                    generality.PUs,
                    vulnerability.Spp,
                    
                #  Results and their errors
                    err_mag, 
                    rsr_COR_euc_out_err_frac
                      )

correlations = cor (bipartite_vars_working_df)
```

```{r}
num_corr_cols = ncol (correlations)
print (correlations [, (num_corr_cols-1) : num_corr_cols])
```

```{r}
    #  Plot the correlation matrix.

corrplot (correlations, tl.cex=0.5
#          , order = "hclust"    #  This fails because of NAs or NaNs in the data...
          )
```

```{r}
possibly_knowable_vars_working_df = 
    select (working_df, #c (

                #  Possibly knowable realized input error values
                    rsp_realized_FP_rate, 
                    rsp_realized_FN_rate, 
                    rsp_realized_Ftot_rate, 
                    rsp_euc_realized_FP_and_cost_in_err_frac, 
                    rsp_euc_realized_FN_and_cost_in_err_frac, 
                    rsp_euc_realized_Ftot_and_cost_in_err_frac, 
                    
                #  Results and their errors
                    err_mag, 
                    rsr_COR_euc_out_err_frac 
                      )

correlations = cor (possibly_knowable_vars_working_df)
```

```{r}
num_corr_cols = ncol (correlations)
print (correlations [, (num_corr_cols-1) : num_corr_cols])
```

```{r}
    #  Plot the correlation matrix.

corrplot (correlations, tl.cex=0.5
#          , order = "hclust"    #  This fails because of NAs or NaNs in the data...
          )
```

```{r}
timing_vars_working_df = 
    select (working_df, #c (

                #  igraph package metrics
                    ig_user_time, 
                    ig_system_time, 
                    ig_elapsed_time, 
                    ig_user_child_time, 
                    ig_sys_child_time, 
                                    
                #  bipartite package metrics
                    bip_user_time, 
                    bip_system_time, 
                    bip_elapsed_time, 
                    bip_user_child_time, 
                    bip_sys_child_time, 

                #  Reserve selector run times
                    RS_user_time, 
                    RS_system_time, 
                    RS_elapsed_time, 
                    RS_user_child_time, 
                    RS_sys_child_time,
            
                #  Results and their errors
                    err_mag, 
                    rsr_COR_euc_out_err_frac 
                      )

correlations = cor (timing_vars_working_df)
```

```{r}
num_corr_cols = ncol (correlations)
print (correlations [, (num_corr_cols-1) : num_corr_cols])
```

```{r}
    #  Plot the correlation matrix.

corrplot (correlations, tl.cex=0.5
#          , order = "hclust"    #  This fails because of NAs or NaNs in the data...
          )
```

-----------------------------

#  Predict performance of specific RS on specific problems

Given all this variability, can you predict how a particular reserve selector will perform on a specific problem?

## Divide into test and training sets.

Want a small sample while I get this working, so just grabbing 100 each for test and train.  

Since the samples are all randomly generated in the first place, I don't need to choose them at random using sample() for the indices.  The first 100 are just as random as anything chosen by sample() would be.

```{r}
num_rows_working_df = nrow (working_df)
num_rows_training_set = round (num_rows_working_df / training_split_denom)
num_rows_test_set = num_rows_working_df - num_rows_training_set

training_rows = 
    sample (1:num_rows_working_df, num_rows_training_set, 
            replace = sample_training_data_with_replacement)

working_train_df = working_df [training_rows, ]
working_test_df = working_df [-training_rows, ]
```

##  Define functions to plot model fit results against test and train data

```{r}
#===============================================================================

plot_pred_eval_for_train_and_test <- 
    function (fitted_model, 
                model_name_str,                 #  e.g., "LM" 
                pred_col_name_str,              #  e.g., "rsr_COR_euc_out_err_frac" 
                pred_value_name_display_str,    #  e.g., "RS out err"
                train_df, 
                test_df, 
                must_specify_predictions_vector=FALSE)
    {           
    old_par = par ("mfrow")
    par (mfrow=c(1,2))
    
    plot_pred_eval (fitted_model, train_df, 
         model_name_str, pred_col_name_str, "TRAIN", 
         pred_value_name_display_str = "RS out err",
         must_specify_predictions_vector)
    
    plot_pred_eval (fitted_model, test_df, 
         model_name_str, pred_col_name_str, "TEST", 
         pred_value_name_display_str = "RS out err",
         must_specify_predictions_vector)
    
    par (old_par)
    }
 
#===============================================================================

plot_pred_eval <- function (fitted_model, 
                             df_to_predict_on, 
                             model_name_str, 
                             pred_col_name_str, 
                             test_or_train_label_str, 
                             pred_value_name_display_str = "RS out err", 
                            must_specify_predictions_vector=FALSE)
    {
    predicted = predict (fitted_model, df_to_predict_on)
    
        #  IMPORTANT:
        #  Some fitting methods like lm() will properly handle the output 
        #  from predict when feeding it to routines like plot(), so you 
        #  don't have to do anything to the predicted output to use it.
        #  Others, like ranger() build an object that doesn't seem to be 
        #  properly interpreted by things like plot() and regr.eval(), so 
        #  you have to find the predictions vector inside the structure and 
        #  use that where you would have used lm()'s output directly.
    
    if (must_specify_predictions_vector) 
        preds = predicted$predictions else 
        preds = predicted
    
    true_values = df_to_predict_on [, pred_col_name_str]
    
    cat ("\nEvaluate results of testing on ", test_or_train_label_str, " data:\n")
    print (regr.eval (true_values, 
                       preds, 
                       #stats = c ("mae", "mse"),    #, "rmse", "mape"))
                       train.y = true_values))
predOnX = FALSE
if (predOnX)
{
    plot (
          preds, 
          true_values, 
          
          main = paste0 (model_name_str, " on ", test_or_train_label_str), 
          xlab = paste0 ("Predicted ", pred_value_name_display_str), 
          ylab = paste0 ("True ", pred_value_name_display_str))
} else
{
    plot (
          true_values, 
          preds, 
          
          main = paste0 (model_name_str, " on ", test_or_train_label_str), 
          ylab = paste0 ("Predicted ", pred_value_name_display_str), 
          xlab = paste0 ("True ", pred_value_name_display_str))
}
    abline (0, 1, lty=2)

    }

#===============================================================================
```

##  Predict **WITHOUT** cheating

### Fit models of **out error using PROBLEM SIZE vars**

#### Fit SIMPLE LINEAR MODEL of out error using PROBLEM SIZE vars

```{r}
lm_Y_out_err_X_prob_size = lm (rsr_COR_euc_out_err_frac ~ 
                                 rsp_num_PUs + 
                                 rsp_num_spp + 
                                 rsp_num_spp_per_PU + 
#           sppPUsum +    #  already covered by sum of 2 other vars above
                                 sppPUprod, 
                              working_train_df)

summary (lm_Y_out_err_X_prob_size)
#plot (lm_Y_out_err_X_prob_size)

plot_pred_eval_for_train_and_test (lm_Y_out_err_X_prob_size, 
                                    model_name_str = "LM", 
                                    pred_col_name_str = "rsr_COR_euc_out_err_frac", 
                                    pred_value_name_display_str = "RS out err",
                                    working_train_df, 
                                    working_test_df, 
                                    must_specify_predictions_vector = FALSE)
```

#### Fit RANDOM FOREST model of out error using PROBLEM SIZE vars

```{r}
#library (ranger)

rf_Y_out_err_X_prob_size = ranger (rsr_COR_euc_out_err_frac ~ 
                                    rsp_num_PUs + 
                                    rsp_num_spp + 
                                    rsp_num_spp_per_PU + 
                                    sppPUsum + 
                                    sppPUprod, 
                              data = working_train_df, 
                              write.forest = TRUE)

summary (rf_Y_out_err_X_prob_size)
#plot (rf_Y_out_err_X_prob_size)

plot_pred_eval_for_train_and_test (rf_Y_out_err_X_prob_size, 
                                    model_name_str = "RF", 
                                    pred_col_name_str = "rsr_COR_euc_out_err_frac", 
                                    pred_value_name_display_str = "RS out err",
                                    working_train_df, 
                                    working_test_df, 
                                    must_specify_predictions_vector = TRUE)
```

### Fit models of **out error using TIMING vars**

NOTE:  Need to reduce these timing variables down since they're definitely collinear.  Just getting them all listed for now.

#### Fit SIMPLE LINEAR MODEL of out error using TIMING vars

```{r}
lm_Y_out_err_X_timings = lm (rsr_COR_euc_out_err_frac ~ 
                            #  igraph package metrics
                                ig_user_time +  
                                ig_system_time +  
                                ig_elapsed_time +  
                                ig_user_child_time +  
                                ig_sys_child_time +  
                                                
                            #  bipartite package metrics
                                bip_user_time +  
                                bip_system_time +  
                                bip_elapsed_time +  
                                bip_user_child_time +  
                                bip_sys_child_time +  
            
                            #  Reserve selector run times
                                RS_user_time +  
                                RS_system_time +  
                                RS_elapsed_time +  
                                RS_user_child_time +  
                                RS_sys_child_time, 
                              working_train_df)

summary (lm_Y_out_err_X_timings)
#plot (lm_Y_out_err_X_timings)

plot_pred_eval_for_train_and_test (lm_Y_out_err_X_timings, 
                                    model_name_str = "LM", 
                                    pred_col_name_str = "rsr_COR_euc_out_err_frac", 
                                    pred_value_name_display_str = "RS out err",
                                    working_train_df, 
                                    working_test_df, 
                                    must_specify_predictions_vector = FALSE)
```

#### Fit RANDOM FOREST model of out error using TIMING vars

```{r}
#library (ranger)

rf_Y_out_err_X_timings = ranger (rsr_COR_euc_out_err_frac ~ 
                            #  igraph package metrics
                                ig_user_time +  
                                ig_system_time +  
                                ig_elapsed_time +  
                                ig_user_child_time +  
                                ig_sys_child_time +  
                                                
                            #  bipartite package metrics
                                bip_user_time +  
                                bip_system_time +  
                                bip_elapsed_time +  
                                bip_user_child_time +  
                                bip_sys_child_time +  
            
                            #  Reserve selector run times
                                RS_user_time +  
                                RS_system_time +  
                                RS_elapsed_time +  
                                RS_user_child_time +  
                                RS_sys_child_time, 
                              data = working_train_df, 
                              write.forest = TRUE)

summary (rf_Y_out_err_X_timings)
#plot (rf_Y_out_err_X_timings)

plot_pred_eval_for_train_and_test (rf_Y_out_err_X_timings, 
                                    model_name_str = "RF", 
                                    pred_col_name_str = "rsr_COR_euc_out_err_frac", 
                                    pred_value_name_display_str = "RS out err",
                                    working_train_df, 
                                    working_test_df, 
                                    must_specify_predictions_vector = TRUE)
```

### Fit models of **out error using GRAPH vars**

#### Fit SIMPLE LINEAR MODEL of out error using GRAPH vars

```{r}
lm_Y_out_err_X_graph_measures = lm (rsr_COR_euc_out_err_frac ~ 
                                    #  igraph package metrics
                                        ig_top +  
                                        ig_bottom +  
                                        ig_num_edges_m +  
                                        ig_ktop +  
                                        ig_kbottom +  
                                        ig_bidens +  
                                        ig_lcctop +  
                                        ig_lccbottom +  
                                        ig_distop +  
                                        ig_disbottom +  
                                        ig_cctop +  
                                        ig_ccbottom +  
                                        ig_cclowdottop +  
                                        ig_cclowdotbottom +  
                                        ig_cctopdottop +  
                                        ig_cctopdotbottom +  
                                        
                                        ig_mean_bottom_bg_redundancy +  
                                        ig_median_bottom_bg_redundancy +  
                                        ig_mean_top_bg_redundancy +  
                                        ig_median_top_bg_redundancy +  
                    
                                    #  bipartite package metrics
                                        connectance +  
                            
                                        web_asymmetry + 
                                        links_per_PUsAndSpp + 
                                        cluster_coefficient + 
                                        weighted_NODF + 
                                        interaction_strength_asymmetry + 
                                        specialisation_asymmetry + 
                                        linkage_density + 
                                        weighted_connectance + 
                                        Shannon_diversity + 
                                        interaction_evenness + 
                                        Alatalo_interaction_evenness + 
                        
                                        mean.number.of.shared.partners.PUs + 
                                        mean.number.of.shared.partners.Spp + 
                                        cluster.coefficient.PUs + 
                                        cluster.coefficient.Spp + 
                                        niche.overlap.PUs + 
                                        niche.overlap.Spp + 
                                        togetherness.PUs + 
                                        togetherness.Spp + 
                                        C.score.PUs + 
                                        C.score.Spp + 
                                        V.ratio.PUs + 
                                        V.ratio.Spp + 
                                        functional.complementarity.PUs + 
                                        functional.complementarity.Spp + 
                                        partner.diversity.PUs + 
                                        partner.diversity.Spp + 
                                        generality.PUs + 
                                        vulnerability.Spp,
                
                              working_train_df)

summary (lm_Y_out_err_X_graph_measures)
#plot (lm_Y_out_err_X_graph_measures)

plot_pred_eval_for_train_and_test (lm_Y_out_err_X_graph_measures, 
                                    model_name_str = "LM", 
                                    pred_col_name_str = "rsr_COR_euc_out_err_frac", 
                                    pred_value_name_display_str = "RS out err",
                                    working_train_df, 
                                    working_test_df, 
                                    must_specify_predictions_vector = FALSE)
```

#### Fit RANDOM FOREST model of out error using GRAPH vars

```{r}
#library (ranger)

rf_Y_out_err_X_graph_measures = ranger (rsr_COR_euc_out_err_frac ~ 
                                    #  igraph package metrics
                                        ig_top +  
                                        ig_bottom +  
                                        ig_num_edges_m +  
                                        ig_ktop +  
                                        ig_kbottom +  
                                        ig_bidens +  
                                        ig_lcctop +  
                                        ig_lccbottom +  
                                        ig_distop +  
                                        ig_disbottom +  
                                        ig_cctop +  
                                        ig_ccbottom +  
                                        ig_cclowdottop +  
                                        ig_cclowdotbottom +  
                                        ig_cctopdottop +  
                                        ig_cctopdotbottom +  
                                        
                                        ig_mean_bottom_bg_redundancy +  
                                        ig_median_bottom_bg_redundancy +  
                                        ig_mean_top_bg_redundancy +  
                                        ig_median_top_bg_redundancy +  
                    
                                    #  bipartite package metrics
                                        connectance +  
                            
                                        web_asymmetry + 
                                        links_per_PUsAndSpp + 
                                        cluster_coefficient + 
                                        weighted_NODF + 
                                        interaction_strength_asymmetry + 
                                        specialisation_asymmetry + 
                                        linkage_density + 
                                        weighted_connectance + 
                                        Shannon_diversity + 
                                        interaction_evenness + 
                                        Alatalo_interaction_evenness + 
                        
                                        mean.number.of.shared.partners.PUs + 
                                        mean.number.of.shared.partners.Spp + 
                                        cluster.coefficient.PUs + 
                                        cluster.coefficient.Spp + 
                                        niche.overlap.PUs + 
                                        niche.overlap.Spp + 
                                        togetherness.PUs + 
                                        togetherness.Spp + 
                                        C.score.PUs + 
                                        C.score.Spp + 
                                        V.ratio.PUs + 
                                        V.ratio.Spp + 
                                        functional.complementarity.PUs + 
                                        functional.complementarity.Spp + 
                                        partner.diversity.PUs + 
                                        partner.diversity.Spp + 
                                        generality.PUs + 
                                        vulnerability.Spp,
                
                              data = working_train_df, 
                              write.forest = TRUE)

summary (rf_Y_out_err_X_graph_measures)
#plot (rf_Y_out_err_X_graph_measures)

plot_pred_eval_for_train_and_test (rf_Y_out_err_X_graph_measures, 
                                    model_name_str = "RF", 
                                    pred_col_name_str = "rsr_COR_euc_out_err_frac", 
                                    pred_value_name_display_str = "RS out err",
                                    working_train_df, 
                                    working_test_df, 
                                    must_specify_predictions_vector = TRUE)
```

### Fit models of **out error using PROB SIZE & GRAPH vars**

#### Fit SIMPLE LINEAR MODEL of out error using PROB SIZE & GRAPH vars

```{r}
lm_Y_out_err_X_probSize_graphMeasures = lm (rsr_COR_euc_out_err_frac ~ 
                                    rsp_num_PUs + 
                                    rsp_num_spp + 
                                    rsp_num_spp_per_PU + 
#                                    sppPUsum + 
                                    sppPUprod + 
                                        
                                    #  igraph package metrics
                                        ig_top +  
                                        ig_bottom +  
                                        ig_num_edges_m +  
                                        ig_ktop +  
                                        ig_kbottom +  
                                        ig_bidens +  
                                        ig_lcctop +  
                                        ig_lccbottom +  
                                        ig_distop +  
                                        ig_disbottom +  
                                        ig_cctop +  
                                        ig_ccbottom +  
                                        ig_cclowdottop +  
                                        ig_cclowdotbottom +  
                                        ig_cctopdottop +  
                                        ig_cctopdotbottom +  
                                        
                                        ig_mean_bottom_bg_redundancy +  
                                        ig_median_bottom_bg_redundancy +  
                                        ig_mean_top_bg_redundancy +  
                                        ig_median_top_bg_redundancy +  
                    
                                    #  bipartite package metrics
                                        connectance +  
                            
                                        web_asymmetry + 
                                        links_per_PUsAndSpp + 
                                        cluster_coefficient + 
                                        weighted_NODF + 
                                        interaction_strength_asymmetry + 
                                        specialisation_asymmetry + 
                                        linkage_density + 
                                        weighted_connectance + 
                                        Shannon_diversity + 
                                        interaction_evenness + 
                                        Alatalo_interaction_evenness + 
                        
                                        mean.number.of.shared.partners.PUs + 
                                        mean.number.of.shared.partners.Spp + 
                                        cluster.coefficient.PUs + 
                                        cluster.coefficient.Spp + 
                                        niche.overlap.PUs + 
                                        niche.overlap.Spp + 
                                        togetherness.PUs + 
                                        togetherness.Spp + 
                                        C.score.PUs + 
                                        C.score.Spp + 
                                        V.ratio.PUs + 
                                        V.ratio.Spp + 
                                        functional.complementarity.PUs + 
                                        functional.complementarity.Spp + 
                                        partner.diversity.PUs + 
                                        partner.diversity.Spp + 
                                        generality.PUs + 
                                        vulnerability.Spp,
                
                              working_train_df)

summary (lm_Y_out_err_X_probSize_graphMeasures)
#plot (lm_Y_out_err_X_probSize_graphMeasures)

plot_pred_eval_for_train_and_test (lm_Y_out_err_X_probSize_graphMeasures, 
                                    model_name_str = "LM", 
                                    pred_col_name_str = "rsr_COR_euc_out_err_frac", 
                                    pred_value_name_display_str = "RS out err",
                                    working_train_df, 
                                    working_test_df, 
                                    must_specify_predictions_vector = FALSE)
```

#### Fit RANDOM FOREST model of out error using PROB SIZE & GRAPH vars

```{r}
#library (ranger)

rf_Y_out_err_X_probSize_graphMeasures = ranger (rsr_COR_euc_out_err_frac ~ 
                                    rsp_num_PUs + 
                                    rsp_num_spp + 
                                    rsp_num_spp_per_PU + 
                                    sppPUsum + 
                                    sppPUprod + 
                                        
                                    #  igraph package metrics
                                        ig_top +  
                                        ig_bottom +  
                                        ig_num_edges_m +  
                                        ig_ktop +  
                                        ig_kbottom +  
                                        ig_bidens +  
                                        ig_lcctop +  
                                        ig_lccbottom +  
                                        ig_distop +  
                                        ig_disbottom +  
                                        ig_cctop +  
                                        ig_ccbottom +  
                                        ig_cclowdottop +  
                                        ig_cclowdotbottom +  
                                        ig_cctopdottop +  
                                        ig_cctopdotbottom +  
                                        
                                        ig_mean_bottom_bg_redundancy +  
                                        ig_median_bottom_bg_redundancy +  
                                        ig_mean_top_bg_redundancy +  
                                        ig_median_top_bg_redundancy +  
                    
                                    #  bipartite package metrics
                                        connectance +  
                            
                                        web_asymmetry + 
                                        links_per_PUsAndSpp + 
                                        cluster_coefficient + 
                                        weighted_NODF + 
                                        interaction_strength_asymmetry + 
                                        specialisation_asymmetry + 
                                        linkage_density + 
                                        weighted_connectance + 
                                        Shannon_diversity + 
                                        interaction_evenness + 
                                        Alatalo_interaction_evenness + 
                        
                                        mean.number.of.shared.partners.PUs + 
                                        mean.number.of.shared.partners.Spp + 
                                        cluster.coefficient.PUs + 
                                        cluster.coefficient.Spp + 
                                        niche.overlap.PUs + 
                                        niche.overlap.Spp + 
                                        togetherness.PUs + 
                                        togetherness.Spp + 
                                        C.score.PUs + 
                                        C.score.Spp + 
                                        V.ratio.PUs + 
                                        V.ratio.Spp + 
                                        functional.complementarity.PUs + 
                                        functional.complementarity.Spp + 
                                        partner.diversity.PUs + 
                                        partner.diversity.Spp + 
                                        generality.PUs + 
                                        vulnerability.Spp,
                
                              data = working_train_df, 
                              write.forest = TRUE)

summary (rf_Y_out_err_X_probSize_graphMeasures)
#plot (rf_Y_out_err_X_probSize_graphMeasures)

plot_pred_eval_for_train_and_test (rf_Y_out_err_X_probSize_graphMeasures, 
                                    model_name_str = "RF", 
                                    pred_col_name_str = "rsr_COR_euc_out_err_frac", 
                                    pred_value_name_display_str = "RS out err",
                                    working_train_df, 
                                    working_test_df, 
                                    must_specify_predictions_vector = TRUE)
```

### Fit models of **out error using TIMINGS & GRAPH vars**

#### Fit SIMPLE LINEAR MODEL of out error using TIMINGS & GRAPH vars

```{r}
lm_Y_out_err_X_timings_graphMeasures = lm (rsr_COR_euc_out_err_frac ~ 

                                #  igraph package metrics
                                ig_user_time +  
                                ig_system_time +  
                                ig_elapsed_time +  
                                ig_user_child_time +  
                                ig_sys_child_time +  
                                                
                            #  bipartite package metrics
                                bip_user_time +  
                                bip_system_time +  
                                bip_elapsed_time +  
                                bip_user_child_time +  
                                bip_sys_child_time +  
            
                            #  Reserve selector run times
                                RS_user_time +  
                                RS_system_time +  
                                RS_elapsed_time +  
                                RS_user_child_time +  
                                RS_sys_child_time +  

                                        
                                    #  igraph package metrics
                                        ig_top +  
                                        ig_bottom +  
                                        ig_num_edges_m +  
                                        ig_ktop +  
                                        ig_kbottom +  
                                        ig_bidens +  
                                        ig_lcctop +  
                                        ig_lccbottom +  
                                        ig_distop +  
                                        ig_disbottom +  
                                        ig_cctop +  
                                        ig_ccbottom +  
                                        ig_cclowdottop +  
                                        ig_cclowdotbottom +  
                                        ig_cctopdottop +  
                                        ig_cctopdotbottom +  
                                        
                                        ig_mean_bottom_bg_redundancy +  
                                        ig_median_bottom_bg_redundancy +  
                                        ig_mean_top_bg_redundancy +  
                                        ig_median_top_bg_redundancy +  
                    
                                    #  bipartite package metrics
                                        connectance +  
                            
                                        web_asymmetry + 
                                        links_per_PUsAndSpp + 
                                        cluster_coefficient + 
                                        weighted_NODF + 
                                        interaction_strength_asymmetry + 
                                        specialisation_asymmetry + 
                                        linkage_density + 
                                        weighted_connectance + 
                                        Shannon_diversity + 
                                        interaction_evenness + 
                                        Alatalo_interaction_evenness + 
                        
                                        mean.number.of.shared.partners.PUs + 
                                        mean.number.of.shared.partners.Spp + 
                                        cluster.coefficient.PUs + 
                                        cluster.coefficient.Spp + 
                                        niche.overlap.PUs + 
                                        niche.overlap.Spp + 
                                        togetherness.PUs + 
                                        togetherness.Spp + 
                                        C.score.PUs + 
                                        C.score.Spp + 
                                        V.ratio.PUs + 
                                        V.ratio.Spp + 
                                        functional.complementarity.PUs + 
                                        functional.complementarity.Spp + 
                                        partner.diversity.PUs + 
                                        partner.diversity.Spp + 
                                        generality.PUs + 
                                        vulnerability.Spp,
                
                              working_train_df)

summary (lm_Y_out_err_X_timings_graphMeasures)
#plot (lm_Y_out_err_X_timings_graphMeasures)

plot_pred_eval_for_train_and_test (lm_Y_out_err_X_timings_graphMeasures, 
                                    model_name_str = "LM", 
                                    pred_col_name_str = "rsr_COR_euc_out_err_frac", 
                                    pred_value_name_display_str = "RS out err",
                                    working_train_df, 
                                    working_test_df, 
                                    must_specify_predictions_vector = FALSE)
```

#### Fit RANDOM FOREST model of out error using TIMINGS & GRAPH vars

```{r}
rf_Y_out_err_X_timings_graphMeasures = ranger (rsr_COR_euc_out_err_frac ~ 

                                #  igraph package metrics
                                ig_user_time +  
                                ig_system_time +  
                                ig_elapsed_time +  
                                ig_user_child_time +  
                                ig_sys_child_time +  
                                                
                            #  bipartite package metrics
                                bip_user_time +  
                                bip_system_time +  
                                bip_elapsed_time +  
                                bip_user_child_time +  
                                bip_sys_child_time +  
            
                            #  Reserve selector run times
                                RS_user_time +  
                                RS_system_time +  
                                RS_elapsed_time +  
                                RS_user_child_time +  
                                RS_sys_child_time +  

                                    #  igraph package metrics
                                        ig_top +  
                                        ig_bottom +  
                                        ig_num_edges_m +  
                                        ig_ktop +  
                                        ig_kbottom +  
                                        ig_bidens +  
                                        ig_lcctop +  
                                        ig_lccbottom +  
                                        ig_distop +  
                                        ig_disbottom +  
                                        ig_cctop +  
                                        ig_ccbottom +  
                                        ig_cclowdottop +  
                                        ig_cclowdotbottom +  
                                        ig_cctopdottop +  
                                        ig_cctopdotbottom +  
                                        
                                        ig_mean_bottom_bg_redundancy +  
                                        ig_median_bottom_bg_redundancy +  
                                        ig_mean_top_bg_redundancy +  
                                        ig_median_top_bg_redundancy +  
                    
                                    #  bipartite package metrics
                                        connectance +  
                            
                                        web_asymmetry + 
                                        links_per_PUsAndSpp + 
                                        cluster_coefficient + 
                                        weighted_NODF + 
                                        interaction_strength_asymmetry + 
                                        specialisation_asymmetry + 
                                        linkage_density + 
                                        weighted_connectance + 
                                        Shannon_diversity + 
                                        interaction_evenness + 
                                        Alatalo_interaction_evenness + 
                        
                                        mean.number.of.shared.partners.PUs + 
                                        mean.number.of.shared.partners.Spp + 
                                        cluster.coefficient.PUs + 
                                        cluster.coefficient.Spp + 
                                        niche.overlap.PUs + 
                                        niche.overlap.Spp + 
                                        togetherness.PUs + 
                                        togetherness.Spp + 
                                        C.score.PUs + 
                                        C.score.Spp + 
                                        V.ratio.PUs + 
                                        V.ratio.Spp + 
                                        functional.complementarity.PUs + 
                                        functional.complementarity.Spp + 
                                        partner.diversity.PUs + 
                                        partner.diversity.Spp + 
                                        generality.PUs + 
                                        vulnerability.Spp,
                
                              data = working_train_df, 
                              write.forest = TRUE)

summary (rf_Y_out_err_X_timings_graphMeasures)
#plot (rf_Y_out_err_X_timings_graphMeasures)

plot_pred_eval_for_train_and_test (rf_Y_out_err_X_timings_graphMeasures, 
                                    model_name_str = "RF", 
                                    pred_col_name_str = "rsr_COR_euc_out_err_frac", 
                                    pred_value_name_display_str = "RS out err",
                                    working_train_df, 
                                    working_test_df, 
                                    must_specify_predictions_vector = TRUE)
```

### Fit models of **out error using PROB SIZE & TIMINGS & GRAPH vars**

#### Fit SIMPLE LINEAR MODEL of out error using PROB SIZE & TIMINGS & GRAPH vars

```{r}
lm_Y_out_err_X_probSize_timings_graphMeasures = lm (rsr_COR_euc_out_err_frac ~ 
                                    rsp_num_PUs + 
                                    rsp_num_spp + 
                                    rsp_num_spp_per_PU + 
#                                    sppPUsum + 
                                    sppPUprod + 
    
    
                                #  igraph package metrics
                                ig_user_time +  
                                ig_system_time +  
                                ig_elapsed_time +  
                                ig_user_child_time +  
                                ig_sys_child_time +  
                                                
                            #  bipartite package metrics
                                bip_user_time +  
                                bip_system_time +  
                                bip_elapsed_time +  
                                bip_user_child_time +  
                                bip_sys_child_time +  
            
                            #  Reserve selector run times
                                RS_user_time +  
                                RS_system_time +  
                                RS_elapsed_time +  
                                RS_user_child_time +  
                                RS_sys_child_time +  

                                        
                                    #  igraph package metrics
                                        ig_top +  
                                        ig_bottom +  
                                        ig_num_edges_m +  
                                        ig_ktop +  
                                        ig_kbottom +  
                                        ig_bidens +  
                                        ig_lcctop +  
                                        ig_lccbottom +  
                                        ig_distop +  
                                        ig_disbottom +  
                                        ig_cctop +  
                                        ig_ccbottom +  
                                        ig_cclowdottop +  
                                        ig_cclowdotbottom +  
                                        ig_cctopdottop +  
                                        ig_cctopdotbottom +  
                                        
                                        ig_mean_bottom_bg_redundancy +  
                                        ig_median_bottom_bg_redundancy +  
                                        ig_mean_top_bg_redundancy +  
                                        ig_median_top_bg_redundancy +  
                    
                                    #  bipartite package metrics
                                        connectance +  
                            
                                        web_asymmetry + 
                                        links_per_PUsAndSpp + 
                                        cluster_coefficient + 
                                        weighted_NODF + 
                                        interaction_strength_asymmetry + 
                                        specialisation_asymmetry + 
                                        linkage_density + 
                                        weighted_connectance + 
                                        Shannon_diversity + 
                                        interaction_evenness + 
                                        Alatalo_interaction_evenness + 
                        
                                        mean.number.of.shared.partners.PUs + 
                                        mean.number.of.shared.partners.Spp + 
                                        cluster.coefficient.PUs + 
                                        cluster.coefficient.Spp + 
                                        niche.overlap.PUs + 
                                        niche.overlap.Spp + 
                                        togetherness.PUs + 
                                        togetherness.Spp + 
                                        C.score.PUs + 
                                        C.score.Spp + 
                                        V.ratio.PUs + 
                                        V.ratio.Spp + 
                                        functional.complementarity.PUs + 
                                        functional.complementarity.Spp + 
                                        partner.diversity.PUs + 
                                        partner.diversity.Spp + 
                                        generality.PUs + 
                                        vulnerability.Spp,
                
                              working_train_df)

summary (lm_Y_out_err_X_probSize_timings_graphMeasures)
#plot (lm_Y_out_err_X_probSize_timings_graphMeasures)

plot_pred_eval_for_train_and_test (lm_Y_out_err_X_probSize_timings_graphMeasures, 
                                    model_name_str = "LM", 
                                    pred_col_name_str = "rsr_COR_euc_out_err_frac", 
                                    pred_value_name_display_str = "RS out err",
                                    working_train_df, 
                                    working_test_df, 
                                    must_specify_predictions_vector = FALSE)
```

#### Fit RANDOM FOREST model of out error using PROB SIZE & TIMINGS & GRAPH vars

```{r}
#library (ranger)

rf_Y_out_err_X_probSize_timings_graphMeasures = ranger (rsr_COR_euc_out_err_frac ~ 
                                    rsp_num_PUs + 
                                    rsp_num_spp + 
                                    rsp_num_spp_per_PU + 
                                    sppPUsum + 
                                    sppPUprod + 
    
                                #  igraph package metrics
                                ig_user_time +  
                                ig_system_time +  
                                ig_elapsed_time +  
                                ig_user_child_time +  
                                ig_sys_child_time +  
                                                
                            #  bipartite package metrics
                                bip_user_time +  
                                bip_system_time +  
                                bip_elapsed_time +  
                                bip_user_child_time +  
                                bip_sys_child_time +  
            
                            #  Reserve selector run times
                                RS_user_time +  
                                RS_system_time +  
                                RS_elapsed_time +  
                                RS_user_child_time +  
                                RS_sys_child_time +  

                                    #  igraph package metrics
                                        ig_top +  
                                        ig_bottom +  
                                        ig_num_edges_m +  
                                        ig_ktop +  
                                        ig_kbottom +  
                                        ig_bidens +  
                                        ig_lcctop +  
                                        ig_lccbottom +  
                                        ig_distop +  
                                        ig_disbottom +  
                                        ig_cctop +  
                                        ig_ccbottom +  
                                        ig_cclowdottop +  
                                        ig_cclowdotbottom +  
                                        ig_cctopdottop +  
                                        ig_cctopdotbottom +  
                                        
                                        ig_mean_bottom_bg_redundancy +  
                                        ig_median_bottom_bg_redundancy +  
                                        ig_mean_top_bg_redundancy +  
                                        ig_median_top_bg_redundancy +  
                    
                                    #  bipartite package metrics
                                        connectance +  
                            
                                        web_asymmetry + 
                                        links_per_PUsAndSpp + 
                                        cluster_coefficient + 
                                        weighted_NODF + 
                                        interaction_strength_asymmetry + 
                                        specialisation_asymmetry + 
                                        linkage_density + 
                                        weighted_connectance + 
                                        Shannon_diversity + 
                                        interaction_evenness + 
                                        Alatalo_interaction_evenness + 
                        
                                        mean.number.of.shared.partners.PUs + 
                                        mean.number.of.shared.partners.Spp + 
                                        cluster.coefficient.PUs + 
                                        cluster.coefficient.Spp + 
                                        niche.overlap.PUs + 
                                        niche.overlap.Spp + 
                                        togetherness.PUs + 
                                        togetherness.Spp + 
                                        C.score.PUs + 
                                        C.score.Spp + 
                                        V.ratio.PUs + 
                                        V.ratio.Spp + 
                                        functional.complementarity.PUs + 
                                        functional.complementarity.Spp + 
                                        partner.diversity.PUs + 
                                        partner.diversity.Spp + 
                                        generality.PUs + 
                                        vulnerability.Spp,
                
                              data = working_train_df, 
                              write.forest = TRUE)

summary (rf_Y_out_err_X_probSize_timings_graphMeasures)
#plot (rf_Y_out_err_X_probSize_timings_graphMeasures)

plot_pred_eval_for_train_and_test (rf_Y_out_err_X_probSize_timings_graphMeasures, 
                                    model_name_str = "RF", 
                                    pred_col_name_str = "rsr_COR_euc_out_err_frac", 
                                    pred_value_name_display_str = "RS out err",
                                    working_train_df, 
                                    working_test_df, 
                                    must_specify_predictions_vector = TRUE)
```

##  Predict **WITH** cheating

- Generally, output error does increase with input error, but still has large variability.

### Fit models of **out error using INPUT ERROR vars**

#### Fit SIMPLE LINEAR MODEL of out error using INPUT ERROR vars

```{r}
lm_Y_out_err_X_in_err = lm (rsr_COR_euc_out_err_frac ~ 
                                   rsp_realized_FP_rate + 
                                   rsp_realized_FN_rate + 
                                   rsp_realized_Ftot_rate + 
                                   rsp_euc_realized_FP_and_cost_in_err_frac + 
                                   rsp_euc_realized_FN_and_cost_in_err_frac + 
                                   rsp_euc_realized_Ftot_and_cost_in_err_frac, 
                              working_train_df)

summary (lm_Y_out_err_X_in_err)
#plot (lm_Y_out_err_X_in_err)

plot_pred_eval_for_train_and_test (lm_Y_out_err_X_in_err, 
                                    model_name_str = "LM", 
                                    pred_col_name_str = "rsr_COR_euc_out_err_frac", 
                                    pred_value_name_display_str = "RS out err",
                                    working_train_df, 
                                    working_test_df, 
                                    must_specify_predictions_vector = FALSE)
```

#### Fit RANDOM FOREST model of out error using INPUT ERROR vars

```{r}
#library (ranger)

rf_Y_out_err_X_in_err = ranger (rsr_COR_euc_out_err_frac ~ 
                                   rsp_realized_FP_rate + 
                                   rsp_realized_FN_rate + 
                                   rsp_realized_Ftot_rate + 
                                   rsp_euc_realized_FP_and_cost_in_err_frac + 
                                   rsp_euc_realized_FN_and_cost_in_err_frac + 
                                   rsp_euc_realized_Ftot_and_cost_in_err_frac, 
                              data = working_train_df, 
                              write.forest = TRUE)

summary (rf_Y_out_err_X_in_err)
#plot (rf_Y_out_err_X_in_err)

plot_pred_eval_for_train_and_test (rf_Y_out_err_X_in_err, 
                                    model_name_str = "RF", 
                                    pred_col_name_str = "rsr_COR_euc_out_err_frac", 
                                    pred_value_name_display_str = "RS out err",
                                    working_train_df, 
                                    working_test_df, 
                                    must_specify_predictions_vector = TRUE)
```

### Fit models of **out error using INPUT ERR & PROB SIZE & TIMINGS & GRAPH vars**

Cheating, using input errors and non-cheating problem characteristics, i.e., pretty much every piece of information we have other than the Xu parameters.

#### Fit SIMPLE LINEAR MODEL of out error using INPUT ERR & PROB SIZE & TIMINGS & GRAPH vars

```{r}
lm_Y_out_err_X_inErr_probSize_timings_graphMeasures = lm (rsr_COR_euc_out_err_frac ~ 
                                   rsp_realized_FP_rate + 
                                   rsp_realized_FN_rate + 
                                   rsp_realized_Ftot_rate + 
                                   rsp_euc_realized_FP_and_cost_in_err_frac + 
                                   rsp_euc_realized_FN_and_cost_in_err_frac + 
                                   rsp_euc_realized_Ftot_and_cost_in_err_frac + 
                                   
                                    rsp_num_PUs + 
                                    rsp_num_spp + 
                                    rsp_num_spp_per_PU + 
#                                    sppPUsum + 
                                    sppPUprod + 
    
    
                                #  igraph package metrics
                                ig_user_time +  
                                ig_system_time +  
                                ig_elapsed_time +  
                                ig_user_child_time +  
                                ig_sys_child_time +  
                                                
                            #  bipartite package metrics
                                bip_user_time +  
                                bip_system_time +  
                                bip_elapsed_time +  
                                bip_user_child_time +  
                                bip_sys_child_time +  
            
                            #  Reserve selector run times
                                RS_user_time +  
                                RS_system_time +  
                                RS_elapsed_time +  
                                RS_user_child_time +  
                                RS_sys_child_time +  

                                        
                                    #  igraph package metrics
                                        ig_top +  
                                        ig_bottom +  
                                        ig_num_edges_m +  
                                        ig_ktop +  
                                        ig_kbottom +  
                                        ig_bidens +  
                                        ig_lcctop +  
                                        ig_lccbottom +  
                                        ig_distop +  
                                        ig_disbottom +  
                                        ig_cctop +  
                                        ig_ccbottom +  
                                        ig_cclowdottop +  
                                        ig_cclowdotbottom +  
                                        ig_cctopdottop +  
                                        ig_cctopdotbottom +  
                                        
                                        ig_mean_bottom_bg_redundancy +  
                                        ig_median_bottom_bg_redundancy +  
                                        ig_mean_top_bg_redundancy +  
                                        ig_median_top_bg_redundancy +  
                    
                                    #  bipartite package metrics
                                        connectance +  
                            
                                        web_asymmetry + 
                                        links_per_PUsAndSpp + 
                                        cluster_coefficient + 
                                        weighted_NODF + 
                                        interaction_strength_asymmetry + 
                                        specialisation_asymmetry + 
                                        linkage_density + 
                                        weighted_connectance + 
                                        Shannon_diversity + 
                                        interaction_evenness + 
                                        Alatalo_interaction_evenness + 
                        
                                        mean.number.of.shared.partners.PUs + 
                                        mean.number.of.shared.partners.Spp + 
                                        cluster.coefficient.PUs + 
                                        cluster.coefficient.Spp + 
                                        niche.overlap.PUs + 
                                        niche.overlap.Spp + 
                                        togetherness.PUs + 
                                        togetherness.Spp + 
                                        C.score.PUs + 
                                        C.score.Spp + 
                                        V.ratio.PUs + 
                                        V.ratio.Spp + 
                                        functional.complementarity.PUs + 
                                        functional.complementarity.Spp + 
                                        partner.diversity.PUs + 
                                        partner.diversity.Spp + 
                                        generality.PUs + 
                                        vulnerability.Spp,
                
                              working_train_df)

summary (lm_Y_out_err_X_inErr_probSize_timings_graphMeasures)
#plot (lm_Y_out_err_X_inErr_probSize_timings_graphMeasures)

plot_pred_eval_for_train_and_test (lm_Y_out_err_X_inErr_probSize_timings_graphMeasures, 
                                    model_name_str = "LM", 
                                    pred_col_name_str = "rsr_COR_euc_out_err_frac", 
                                    pred_value_name_display_str = "RS out err",
                                    working_train_df, 
                                    working_test_df, 
                                    must_specify_predictions_vector = FALSE)
```

#### Fit RANDOM FOREST model of out error using INPUT ERR & PROB SIZE & TIMINGS & GRAPH vars

```{r}
#library (ranger)

rf_Y_out_err_X_inErr_probSize_timings_graphMeasures = ranger (rsr_COR_euc_out_err_frac ~ 
                                    rsp_num_PUs + 
                                    rsp_num_spp + 
                                    rsp_num_spp_per_PU + 
                                    sppPUsum + 
                                    sppPUprod + 
    
                                #  igraph package metrics
                                ig_user_time +  
                                ig_system_time +  
                                ig_elapsed_time +  
                                ig_user_child_time +  
                                ig_sys_child_time +  
                                                
                            #  bipartite package metrics
                                bip_user_time +  
                                bip_system_time +  
                                bip_elapsed_time +  
                                bip_user_child_time +  
                                bip_sys_child_time +  
            
                            #  Reserve selector run times
                                RS_user_time +  
                                RS_system_time +  
                                RS_elapsed_time +  
                                RS_user_child_time +  
                                RS_sys_child_time +  

                                    #  igraph package metrics
                                        ig_top +  
                                        ig_bottom +  
                                        ig_num_edges_m +  
                                        ig_ktop +  
                                        ig_kbottom +  
                                        ig_bidens +  
                                        ig_lcctop +  
                                        ig_lccbottom +  
                                        ig_distop +  
                                        ig_disbottom +  
                                        ig_cctop +  
                                        ig_ccbottom +  
                                        ig_cclowdottop +  
                                        ig_cclowdotbottom +  
                                        ig_cctopdottop +  
                                        ig_cctopdotbottom +  
                                        
                                        ig_mean_bottom_bg_redundancy +  
                                        ig_median_bottom_bg_redundancy +  
                                        ig_mean_top_bg_redundancy +  
                                        ig_median_top_bg_redundancy +  
                    
                                    #  bipartite package metrics
                                        connectance +  
                            
                                        web_asymmetry + 
                                        links_per_PUsAndSpp + 
                                        cluster_coefficient + 
                                        weighted_NODF + 
                                        interaction_strength_asymmetry + 
                                        specialisation_asymmetry + 
                                        linkage_density + 
                                        weighted_connectance + 
                                        Shannon_diversity + 
                                        interaction_evenness + 
                                        Alatalo_interaction_evenness + 
                        
                                        mean.number.of.shared.partners.PUs + 
                                        mean.number.of.shared.partners.Spp + 
                                        cluster.coefficient.PUs + 
                                        cluster.coefficient.Spp + 
                                        niche.overlap.PUs + 
                                        niche.overlap.Spp + 
                                        togetherness.PUs + 
                                        togetherness.Spp + 
                                        C.score.PUs + 
                                        C.score.Spp + 
                                        V.ratio.PUs + 
                                        V.ratio.Spp + 
                                        functional.complementarity.PUs + 
                                        functional.complementarity.Spp + 
                                        partner.diversity.PUs + 
                                        partner.diversity.Spp + 
                                        generality.PUs + 
                                        vulnerability.Spp,
                
                              data = working_train_df, 
                              write.forest = TRUE)

summary (rf_Y_out_err_X_inErr_probSize_timings_graphMeasures)
#plot (rf_Y_out_err_X_inErr_probSize_timings_graphMeasures)

plot_pred_eval_for_train_and_test (rf_Y_out_err_X_inErr_probSize_timings_graphMeasures, 
                                    model_name_str = "RF", 
                                    pred_col_name_str = "rsr_COR_euc_out_err_frac", 
                                    pred_value_name_display_str = "RS out err",
                                    working_train_df, 
                                    working_test_df, 
                                    must_specify_predictions_vector = TRUE)
```

-----------------------------

#  More questions

##  Does Easy vs. Hard matter?

Since most existing papers use easy problems (small toy problems or random problems), does that matter?

###  Are descriptive results different?

```{r}
cat ("\n...  Break down by Easy vs. Hard  ...\n")
```

###  Are predictive results different?

Can use the Easy/Hard labels with the same facetting code I had earlier for Base vs Wrap plots.  

- If I train on Easy, how well do I do predicting on Hard?  
- If I train on Hard, how well do I do predicting on Easy?  
- If I train on mixed, how well do I do predicting on mixed?  

```{r}
cat ("\n...  Predict using different train/test sources  ...\n")
```

-----------------------------

#  Test code to be saved for now

##  Testing predictive plot function call 
- Using algae data set from Torgo's book
- Done on 2018 11 26 18 12

This worked fine.

```
#library (ranger)

library (DMwR)
#library (DMwR2) 

library (rpart)
data (algae)
#algae <- as.data.frame (algae)
algae <- algae [-manyNAs (algae), ]

algae_train = algae [, 1:12]
algae_test = algae [, 1:12]

#rt.a1 <- rpart (a1 ~ ., data = algae [, 1:12])
rt.a1 <- rpart (a1 ~ ., data = algae_train)

if (FALSE)
{
summary (rt.a1)


    preds = predict (rt.a1, data=algae_train)

    true_values = algae_train [, "a1"]
    
    regr.eval (true_values, 
                       preds, 
                       #stats = c ("mae", "mse"),    #, "rmse", "mape"))
                       train.y = true_values)
    
    model_name_str = "RF"
    test_or_train_label_str = "TRAIN"
    pred_value_name_display_str = "RS out err"
    plot (preds, 
          true_values, 
          main = paste0 (model_name_str, " on ", test_or_train_label_str), 
          xlab = paste0 ("Predicted ", pred_value_name_display_str), 
          ylab = paste0 ("True ", pred_value_name_display_str))
    abline (0, 1, lty=2)
}

plot_pred_eval_for_train_and_test (rt.a1, 
                                    model_name_str = "RT", 
                                    pred_col_name_str = "a1", 
                                    algae_train, 
                                    algae_test)





if (FALSE)
{
train.idx <- sample (x = 1:150, size = 100)
iris.train <- iris [train.idx, ]
iris.test <- iris [-train.idx, ]

rf <- ranger (Species ~ ., 
              data = iris.train, 
              write.forest = TRUE)

summary (rf)

plot_pred_eval_for_train_and_test (rf, 
                                    model_name_str = "RF", 
                                    pred_col_name_str = "Species", 
                                    iris.train, 
                                    iris.test)

}
```

